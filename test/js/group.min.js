require.config({paths:{common:"common.min",swiper:"swiper-bundle.min",jquery:"jquery-3.2.1"}}),define(["common","swiper","jquery"],function(v,s,g){v.init();var u={id:v.parseQueryString().id,commentList:[],env:"dev",server:{dev:"//dev.xiangdao.info",pro:"//www.xiangdao.info"},swapArray:function(i,e,n){return i[e]=i.splice(n,1,i[e])[0],i},eventBind:function(){g(document).off("click").on("click",".cop-more",function(){var t=g(this),a=parseInt(t.data("id")),i=t.data("switch"),e=parseInt(t[0].dataset.page);if("off"===i)u.requestReplyList(a,u.getPageSize(e),t,e);else{var n=u.commentList;n&&0<n.length&&n.forEach(function(i){if(i.commentId===a){var e=i.childCommentCount-i.list.length,n=4<e?5:e;t.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+n+"\u6761\u56de\u590d")}}),t.data("switch","off"),t.find(".cop-more-btn").removeClass("col"),t[0].dataset.page=1,t.prev(".comment-reply").find(".cop-li-add").remove(),n&&0<n.length&&n.forEach(function(i){i.commentId===a&&(i.totalList=i.list)})}}),g(document).on("click",".full-swiper-slide",function(){swiper2.removeAllSlides(),swiper2.updateSlides(),swiper2.destroy(),g("#fullPageImages").hide()}),g(document).on("click",".comment-img,.cop-con-show-img",function(){var i=g(this).data("img").split(","),e=parseInt(g(this).data("index"));if(i&&0<i.length){swiper2=new s("#fullPageImages",{init:!1,initialSlide:e,lazy:{elementClass:"swiper-lazy"}});var n="";i.forEach(function(i){n+='<div class="swiper-slide full-swiper-slide" style="background: url('+i+') no-repeat center / 100%"></div>'}),u.q("#fullPageWrap").innerHTML=n,u.q("#fullPageImages").style.display="block",swiper2.init(),swiper2.update()}})},q:function(i){return document.querySelector(i)},getPageSize:function(i){parseInt(i);return 5},parseDate:function(i){var e=new Date(i);return e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())},parseDateForComment:function(i){var e=new Date(i);return(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())},init:function(){u.eventBind(),u.initSwiper(),u.initPageData(),u.onAMapLoaded()},initPageData:function(){g.ajax({url:u.server[u.env]+"/xiangdao-api/api/tuan/group_details",method:"POST",dataType:"json",async:!1,headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({groupId:u.id}),success:function(i){if(console.log(i),0===i.status){var d=i.json;u.locationCity=d.locationCity,u.locationDetail=d.locationDetail,u.locationProvinceName=d.locationProvinceName,u.locationCityName=d.locationCityName,u.locationTownName=d.locationTownName;var e=u.q(".top-tit"),n=u.q("#villageNo"),t=u.q(".top-tags-l"),a=u.q(".top-sif-l"),s=u.q(".m-tit-rm"),o=u.q("#headImgs"),l="";if(d.video&&(l+='<div class="swiper-slide"><video id="video" class="head-video-li" preload="auto" controls  webkit-playsinline="true"\n playsinline="true"\n x5-playsinline="true"\n x5-video-player-type="h5"\n x5-video-player-fullscreen=""\n x5-video-orientation="portraint"\n x-webkit-airplay="true"\n controls="controls" src="'+d.video+'" poster="'+d.videoGif+'" /></div>'),d.briefImages)d.briefImages.split(",").forEach(function(i){l+='<div class="swiper-slide"><img class="head-img-li" src="'+i+'" alt/></div>'});if(o.innerHTML=l,u.swiper2.update(),e.innerText=d.villageName,n.innerText=d.villageNo,d.tagName){var c=d.tagName.split(","),r="";c.forEach(function(i,e){e<4?r+='<div class="top-tag">'+i+"</div>":u.q(".top-tags-r").style.display="block"}),t.innerHTML=r}if(d.brief&&(a.innerText=d.brief),d.surplusTimestamp&&0<d.surplusTimestamp){u.surplusTimestamp=d.surplusTimestamp,s.innerHTML=u.formatTime(d.surplusTimestamp);var p=setInterval(function(){var i=u.surplusTimestamp-1;s.innerHTML=u.formatTime(0<i?i:0),(u.surplusTimestamp=i)<=0&&clearInterval(p)},1e3)}if(d.list&&0<d.list.length){var m="";d.list.forEach(function(i){if(i.status=1,m+='<div class="group-li '+(2===i.status?"gl-out":"")+'" data-id="'+i.tuanId+'">\n                <img class="gli-l" src="'+i.infoCover+'" alt/>\n                <div class="gli-r">\n                    <div class="gli-tit">'+i.infoTitle+'</div>\n                    <div class="gli-tags">\n',i.tagName){var n="";i.tagName.split(",").forEach(function(i,e){e<3&&(n+='<div class="gli-tag">'+i+"</div>")}),m+=n}m+='        </div>\n                    <div class="gli-price">\u62fc\u56e2\u4ef7\uff1a<i>\uffe5</i><span>'+i.tuanPrice+'</span></div>\n                    <div class="gli-inf">'+(i.tuanNotice?i.tuanNotice:"")+"</div>\n",1===i.status?m+='<div class="gli-od gli-in">\u8ba2</div>':2===i.status&&(m+='<div class="gli-od gli-out"></div>'),m+="                </div>\n            </div>"}),u.q(".group-con").innerHTML=m}d.villageIcon?v.request({url:u.server[u.env]+"/xiangdao-api/api/houseEditor/get_village_icon_group",success:function(i){console.log(i);var e=i.json;if(e&&0<e.length){var n="",s=d.villageIcon.split(",");(e=u.swapArray(e,0,1)).forEach(function(a){n+='<div class="ist" data-id="'+a.type+'">\n                <div class="ist-l">\n                    <img class="ist-icon" src="'+a.typeUrl+'" alt/>\n                    <div class="ist-text">'+a.typeName+'</div>\n                </div>\n                <div class="ist-r">\n';var i="";a.list.forEach(function(n){var t=!1;s&&0<s.length&&s.forEach(function(i){var e=i.split("-");e[0]==a.type&&e[1]==n.iconSeq&&(t=!0)}),t&&(i+='<div class="ist-li '+(t?"sel":"")+'" data-id="'+n.iconSeq+'">'+n.iconName+"</div>")}),n+=i,n+="</div></div>"});var t=u.q("#insWrap");t.innerHTML=n;var a=document.querySelectorAll(".ist"),o=[];if(a&&0<a.length){for(var l=0;l<a.length;l++){0===g(a[l]).find(".ist-li").length&&o.push(g(".ist").eq(l))}0<o.length&&o.forEach(function(i){i.remove()});var c=0,r=t.querySelectorAll(".ist");r.length<4&&g("#insMore").hide(),[2,3,5].forEach(function(e){r.forEach(function(i){e===parseInt(i.dataset.id)&&(c+=i.clientHeight)})}),t.style.height=c+"px",console.log(c)}else g("#insMore").parents(".pan").hide()}}}):g("#insMore").parents(".m-ist").hide(),d.mustSee?u.q("#mustSee").innerHTML=d.mustSee:u.q("#mustSee").parentNode.style.display="none",d.hotelPolicy?u.q("#hotelPolicy").innerHTML=d.hotelPolicy:u.q("#hotelPolicy").parentNode.style.display="none",g.ajax({url:u.server[u.env]+"/xiangdao-api/api/news/new_comment_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({bizId:u.id,bizType:5}),success:function(i){if(console.log(i),0===i.status){var e=i.json.result;if((u.commentList=e)&&0<e.length){e.forEach(function(i){i.totalList=i.list}),u.renderCommentList();var n=document.querySelectorAll(".link");if(n&&0<n.length)for(var t=0;t<n.length;t++)n[t].addEventListener("click",function(){openApp()},!1)}else{u.q("#comment").innerHTML='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>'}}}})}}})},initSwiper:function(){u.q("#pag");u.swiper2=new s(".top-swiper-container",{pagination:{el:".top-swiper-pagination",type:"fraction"},on:{transitionEnd:function(){var i=document.querySelectorAll("video");if(i&&0<i.length)for(var e=0;e<i.length;e++)i[e].pause()}}})},formatTime:function(i){var e=parseInt(i/86400),n=parseInt(i%86400/3600),t=parseInt(i%3600/60),a=parseInt(i%60);return n<10&&(n="0"+n),t<10&&(t="0"+t),a<10&&(a="0"+a),(0<e?"<i>"+e+"</i>\u5929":"")+"<i>"+n+"</i>:<i>"+t+"</i>:<i>"+a+"</i>"},requestReplyList:function(l,i,c,r){g.ajax({url:u.server[u.env]+"/xiangdao-api/api/news/new_comment_child_list",method:"POST",dataType:"json",async:!1,headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({commentId:l,pageSize:i,pageNo:r}),success:function(t){if(console.log(t),0===t.status){var i="",a=t.json.result,n=u.commentList;if(a&&0<a.length){a.forEach(function(e){n.forEach(function(i){l===i.commentId&&i.totalList&&0<i.totalList.length&&i.totalList.forEach(function(i){i.commentId===e.commentId&&(e.hide=!0)})})}),i+=u.renderReplyList(a);var e=c.prev(".comment-reply");0<e.length?e.append(i):c.before('<div class="comment-reply">'+i+"</div>");var s=document.querySelectorAll(".link");if(s&&0<s.length)for(var o=0;o<s.length;o++)s[o].addEventListener("click",function(){openApp()},!1)}n.forEach(function(i){if(i.commentId===l)if(i.totalList=i.totalList.concat(a),i.totalList.length<t.json.totalCount){var e=t.json.totalCount-i.totalList.length+i.list.length,n=4<e?5:e;c.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+n+"\u6761\u56de\u590d"),c.find(".cop-more-btn").removeClass("col"),r++,c[0].dataset.page=r}else c.find(".cop-more-text").text("\u6536\u8d77\u5168\u90e8\u56de\u590d"),c.find(".cop-more-btn").addClass("col"),c.data("switch","on")})}}})},renderReplyList:function(i){var e="";return i.forEach(function(i){i.hide||(e+='<div class="cop-li cop-li-add" data-id="'+i.commentId+'">\n            <img class="cop-l" src="'+i.avatar+'" alt />\n            <div class="cop-c">\n                 <div class="cop-name">'+i.nickName+(1===i.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                 <div class="cop-con">\n'+(i.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+i.parentNickName+"</span>\uff1a":"")+(i.content?i.content:""),i.images&&(e+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+i.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),e+='</div>\n                 <div class="cop-fun">\n                      <div class="cop-time">'+u.parseDateForComment(i.createDate)+' \xb7 </div>\n                      <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                      <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                 </div>\n            </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(0<i.likeCount?i.likeCount:"")+"</div></div>       </div>")}),e},renderCommentList:function(){var i=u.commentList;if(i&&0<i.length){var s="";i.forEach(function(i){if(s+='<div class="comment-li" data-id="'+i.commentId+'">\n<div class="comment-li-wrap">                        <img class="comment-l" src="'+i.avatar+'" alt />\n                        <div class="comment-c">\n                            <div class="comment-name">'+i.nickName+'</div>\n                            <div class="comment-con">'+(i.content?i.content:"")+"</div>\n",i.images){var e=i.images.split(",");if(e&&0<e.length){for(var n='<div class="comment-imgs">',t=0;t<e.length;t++)n+='<img class="comment-img swiper-lazy" data-index="'+t+'" data-img="'+i.images+'" src="'+e[t]+'" alt />';s+=n+="</div>"}}if(s+='<div class="comment-fun">\n                <div class="comment-time">'+u.parseDateForComment(i.createDate)+' \xb7 </div>\n                <div class="comment-btn-reply link">\u56de\u590dTA</div>\n                <img class="comment-btn-more link" src="img/icon_more_s.png" alt />\n           </div>',s+='</div>\n           <div class="comment-r link">\n               <img class="comment-like-icon" src="img/icon_like_g.png" alt />\n               <div class="comment-like-num">'+(0<i.likeCount?i.likeCount:"")+"</div>\n           </div>\n       </div>",i.totalList&&0<i.totalList.length){var a="";a+='<div class="comment-reply">',i.totalList.forEach(function(i){a+='<div class="cop-li" data-id="'+i.commentId+'">\n              <img class="cop-l" src="'+i.avatar+'" alt />\n              <div class="cop-c">\n                   <div class="cop-name">'+i.nickName+(1===i.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                   <div class="cop-con">\n                        '+(i.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+i.parentNickName+"</span>\uff1a":"")+(i.content?i.content:"")+"\n",i.images&&(a+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+i.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),a+='                   </div>\n                   <div class="cop-fun">\n                        <div class="cop-time">'+u.parseDateForComment(i.createDate)+' \xb7 </div>\n                        <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                        <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                   </div>\n              </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(0<i.likeCount?i.likeCount:"")+"</div></div>         </div>\n"}),s+=a+="</div>"}0<i.childCommentCount-i.totalList.length&&(s+='<div class="cop-more" data-page="1" data-switch="off" data-id="'+i.commentId+'"><span class="cop-more-text">\u70b9\u51fb\u5c55\u5f00'+(4<i.childCommentCount-i.totalList.length?5:i.childCommentCount-i.totalList.length)+'\u6761\u56de\u590d</span><img class="cop-more-btn" src="img/icon_arrow_g2.png" alt /></div>'),g("#commentList").html(s)})}}},i=document.querySelectorAll(".pan-showall");if(i&&0<i.length)for(var e=0;e<i.length;e++)i[e].addEventListener("click",function(){var i=this.previousElementSibling;i&&i.classList.add("showAll"),this.style.display="none"},!1);g(".show-all").on("click",function(){var i=g(this);i.hasClass("cols")?(i.removeClass("cols").find("span").text("\u6536\u8d77"),i.prev(".vp-list").addClass("showAll")):(i.addClass("cols").find("span").text("\u5c55\u5f00"),i.prev(".vp-list").removeClass("showAll"))});var n=document.querySelectorAll(".link");if(n&&0<n.length)for(var t=0;t<n.length;t++)n[t].addEventListener("click",function(){openApp()},!1);u.onAMapLoaded=function(){var a=new AMap.Map("mapContainer",{zoom:11});AMap.plugin("AMap.Geocoder",function(){(new AMap.Geocoder).getLocation(u.locationProvinceName+u.locationCityName+u.locationTownName,function(i,e){if("complete"===i&&e.geocodes.length){var n=e.geocodes[0].location;a.setCenter([n.lng,n.lat]),u.lng=n.lng,u.lat=n.lat;var t=new AMap.Marker({icon:"/h5/img/pos.png",position:[n.lng,n.lat],anchor:"bottom-center"});a.add(t),AMap.plugin(["AMap.PlaceSearch"],function(){var i=new AMap.PlaceSearch({pageSize:6,pageIndex:1,datatype:"poi",city:u.locationCity,citylimit:!0,autoFitView:!0});i.searchNearBy("\u706b\u8f66\u7ad9",[n.lng,n.lat],1e5,function(i,e){var n=u.q("#railwayStation");if(e&&e.poiList&&e.poiList.pois&&0<e.poiList.pois.length){var t=e.poiList.pois,a="";t.forEach(function(i){a+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),n.innerHTML=a;new s(".s-crh",{slidesPerView:"auto",spaceBetween:30})}else n.parentNode.parentNode.parentNode.style.display="none"}),i.searchNearBy("\u6c7d\u8f66\u7ad9",[n.lng,n.lat],1e5,function(i,e){var n=u.q("#busStation");if(e&&e.poiList&&e.poiList.pois&&0<e.poiList.pois.length){var t=e.poiList.pois,a="";t.forEach(function(i){a+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),n.innerHTML=a;new s(".s-bus",{slidesPerView:"auto",spaceBetween:30})}else n.parentNode.parentNode.parentNode.style.display="none"}),i.searchNearBy("\u9ad8\u901f\u8def\u53e3",[n.lng,n.lat],1e5,function(i,e){var n=u.q("#crossing");if(e&&e.poiList&&e.poiList.pois&&0<e.poiList.pois.length){var t=e.poiList.pois,a="";t.forEach(function(i){a+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),n.innerHTML=a;new s(".s-crossing",{slidesPerView:"auto",spaceBetween:30})}else n.parentNode.parentNode.parentNode.style.display="none"})})}else console.log("\u83b7\u53d6\u7ecf\u7eac\u5ea6\u5931\u8d25")})})},u.init()});