require.config({paths:{common:"common.min",swiper:"swiper.min",jquery:"jquery-3.2.1"}}),define(["common","swiper","jquery"],function(v,s,p){v.init();var g={s:["","\u680b","\u95f4","\u5957","\u4eba"],env:"dev",server:{dev:"//dev.xiangdao.info",pro:"//www.xiangdao.info"},parseDate:function(i){var e=new Date(i);return(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())},swapArray:function(i,e,n){return i[e]=i.splice(n,1,i[e])[0],i},q:function(i){return document.querySelector(i)},init:function(){g.id=v.parseQueryString().id;var r=new s(".swiper-album",{slidesPerView:2.5,spaceBetween:20,init:!1});v.request({url:g.server[g.env]+"/xiangdao-api/api/news/village_details/"+g.id,method:"GET",success:function(i){console.log(i);var d=i.json;g.locationCity=d.locationCity,g.locationDetail=d.locationDetail,g.locationProvinceName=d.locationProvinceName,g.locationCityName=d.locationCityName,g.locationTownName=d.locationTownName;var e=g.q("#playVideo"),n=g.q("#imgList"),t=g.q(".contentTitle"),a=g.q(".contentSTitle"),s=g.q(".contentContent"),l=g.q("#likeCount");if(e.src=d.video,e.poster=d.videoGif,d.briefImages){var o=d.briefImages.split(",");if(o&&0<o.length){var c="";o.forEach(function(i){c+='<div class="swiper-slide album-li" style="background-image: url('+i+')"></div>'}),n.innerHTML=c,r.init()}}t.innerText=d.villageName,a.innerText=d.lookNumber?d.lookNumber+"\u4eba\u89c2\u770b":"",l.innerText=d.likeCount,s.innerHTML=d.content,d.villageId&&p.ajax({url:g.server[g.env]+"/xiangdao-api/api/house/house_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({villageId:d.villageId,pageSize:20}),success:function(i){if(console.log(i),0===i.status){var e=i.json.result;if(e&&0<e.length){var n="";e.forEach(function(i){n+='<div class="vp-li" data-id="'+i.houseId+'">\n                <img class="vp-l" src="'+i.infoCover+'" alt />\n                <div class="vp-r">\n                    <div class="vp-st">'+i.profileStr+'</div>\n                    <div class="vp-ti">'+i.infoTitle+'</div>\n                    <div class="vp-price"><span>\uffe5<i>'+i.ruleMonthMoney+"</i></span>"+(i.profileRentMode?"/"+g.s[i.profileRentMode]:"")+"/\u6708</div>\n                </div>\n            </div>"}),g.q(".vp-list").innerHTML=n,1===e.length?(g.q(".vp-list").style.height="2.32rem",g.q(".show-all").style.display="none"):(2===e.length&&(g.q(".show-all").style.display="none"),g.q(".vp-list").style.height="5.6rem"),p(".vp-li").on("click",function(){var i=p(this).data("id");location.href="house_details.html?houseId="+i})}else g.q(".vp-wrap").style.display="none"}}}),d.villageIcon?v.request({url:g.server[g.env]+"/xiangdao-api/api/houseEditor/get_village_icon_group",success:function(i){console.log(i);var e=i.json;if(e&&0<e.length){var n="",s=d.villageIcon.split(",");(e=g.swapArray(e,0,1)).forEach(function(a){n+='<div class="ist" data-id="'+a.type+'">\n                <div class="ist-l">\n                    <img class="ist-icon" src="'+a.typeUrl+'" alt/>\n                    <div class="ist-text">'+a.typeName+'</div>\n                </div>\n                <div class="ist-r">\n';var i="";a.list.forEach(function(n){var t=!1;s&&0<s.length&&s.forEach(function(i){var e=i.split("-");e[0]==a.type&&e[1]==n.iconSeq&&(t=!0)}),t&&(i+='<div class="ist-li '+(t?"sel":"")+'" data-id="'+n.iconSeq+'">'+n.iconName+"</div>")}),n+=i,n+="</div></div>"});var t=g.q("#insWrap");t.innerHTML=n;var a=document.querySelectorAll(".ist"),l=[];if(a&&0<a.length){for(var o=0;o<a.length;o++){0===p(a[o]).find(".ist-li").length&&l.push(p(".ist").eq(o))}0<l.length&&l.forEach(function(i){i.remove()});var c=0,r=t.querySelectorAll(".ist");r.length<4&&p("#insMore").hide(),[2,3,5].forEach(function(e){r.forEach(function(i){e===parseInt(i.dataset.id)&&(c+=i.clientHeight)})}),t.style.height=c+"px",console.log(c)}else p("#insMore").parents(".pan").hide()}}}):p("#insMore").parents(".pan").hide(),p.ajax({url:g.server[g.env]+"/xiangdao-api/api/news/comment_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({bizId:parseInt(g.id),bizType:1,pageNo:1}),success:function(i){console.log(i);var e=i.json.result,s="";e&&0<e.length?(g.q("#totalCount").innerText=" \xb7 "+i.json.totalCount,e.forEach(function(i){var e="",n="",t="";if(i.images){e+='<div class="cli-imgs">\n';var a=i.images.split(",");a&&0<a.length&&a.forEach(function(i){e+='<img class="cli-img" src="'+i+'" alt />'}),e+="</div>\n"}i.list&&0<i.list.length&&(n+='<div class="cli-reply">\n',i.list.forEach(function(i){n+='                        <div class="clr-li">\n                            <img class="clr-l" src="'+i.avatar+'" alt />\n                            <div class="clr-r">\n                                <div class="clr-name">'+i.nickName+'</div>\n                                <div class="clr-cont">'+(i.parentNickName?"\u56de\u590d"+i.parentNickName+": ":"")+i.content+'</div>\n                                <div class="clr-fun">\n                                    <div class="clr-fl">'+g.parseDate(i.createDate)+'</div>\n                                    <div class="clr-fr">\n                                        <div class="clrr-li link">\n                                            <img class="clrr-icon" src="img/icon_reply.png" alt />\n                                            <div class="clrr-text">\u56de\u590d</div>\n                                        </div>\n                                        <div class="clrr-li link">\n                                            <img class="clrr-icon" src="img/praise.png" alt />\n                                            <div class="clrr-text">'+(i.isLike?"\u5df2\u70b9\u8d5e":"\u70b9\u8d5e")+"</div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n"}),n+="                    </div>"),t+='<div class="cli-fun">\n                        <div class="cf-l">'+g.parseDate(i.createDate)+'</div>\n                        <div class="cf-r">\n                            <div class="cf-ri link">\n                                <img class="cfr-icon" src="img/icon_reply.png" alt />\n                                <div class="cfr-text">'+(i.childCommentCount?i.childCommentCount:"\u56de\u590d")+'</div>\n                            </div>\n                            <div class="cf-ri link">\n                                <img class="cfr-icon" src="img/praise.png" alt />\n                                <div class="cfr-text">'+(i.likeCount?i.likeCount:"\u70b9\u8d5e")+"</div>\n                            </div>\n                        </div>\n                    </div>",s+='<div class="cli">\n                <img class="cli-l" src="'+i.avatar+'" alt />\n                <div class="cli-r">\n                    <div class="cli-name">'+i.nickName+'<img class="cli-report link" src="img/icon_alarm.png" alt /></div>\n                    <div class="cli-txt">'+i.content+"</div>\n"+e+n+t+"                </div>\n            </div>"})):s+='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>',g.q(".com-list").innerHTML=s;var n=document.querySelectorAll(".link");if(n&&0<n.length)for(var t=0;t<n.length;t++)n[t].addEventListener("click",function(){openApp()},!1)}})}});var i=document.querySelectorAll(".pan-showall");if(i&&0<i.length)for(var e=0;e<i.length;e++)i[e].addEventListener("click",function(){var i=this.previousElementSibling;i&&i.classList.add("showAll"),this.style.display="none"},!1);p(".show-all").on("click",function(){var i=p(this);i.hasClass("cols")?(i.removeClass("cols").find("span").text("\u6536\u8d77"),i.prev(".vp-list").addClass("showAll")):(i.addClass("cols").find("span").text("\u5c55\u5f00"),i.prev(".vp-list").removeClass("showAll"))});var n=document.querySelectorAll(".link");if(n&&0<n.length)for(var t=0;t<n.length;t++)n[t].addEventListener("click",function(){openApp()},!1);g.onAMapLoaded()},onAMapLoaded:function(){var a=new AMap.Map("mapContainer",{zoom:11});AMap.plugin("AMap.Geocoder",function(){(new AMap.Geocoder).getLocation(g.locationProvinceName+g.locationCityName+g.locationTownName,function(i,e){if("complete"===i&&e.geocodes.length){var n=e.geocodes[0].location;a.setCenter([n.lng,n.lat]),g.lng=n.lng,g.lat=n.lat;var t=new AMap.Marker({icon:"/h5/img/pos.png",position:[n.lng,n.lat],anchor:"bottom-center"});a.add(t),AMap.plugin(["AMap.PlaceSearch"],function(){var i=new AMap.PlaceSearch({pageSize:6,pageIndex:1,datatype:"poi",city:g.locationCity,citylimit:!0,autoFitView:!0});i.searchNearBy("\u706b\u8f66\u7ad9",[n.lng,n.lat],1e5,function(i,e){var n=g.q("#railwayStation");if(e&&e.poiList&&e.poiList.pois&&0<e.poiList.pois.length){var t=e.poiList.pois,a="";t.forEach(function(i){a+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),n.innerHTML=a;new s(".s-crh",{slidesPerView:"auto",spaceBetween:30})}else n.parentNode.parentNode.parentNode.style.display="none"}),i.searchNearBy("\u6c7d\u8f66\u7ad9",[n.lng,n.lat],1e5,function(i,e){var n=g.q("#busStation");if(e&&e.poiList&&e.poiList.pois&&0<e.poiList.pois.length){var t=e.poiList.pois,a="";t.forEach(function(i){a+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),n.innerHTML=a;new s(".s-bus",{slidesPerView:"auto",spaceBetween:30})}else n.parentNode.parentNode.parentNode.style.display="none"}),i.searchNearBy("\u9ad8\u901f\u8def\u53e3",[n.lng,n.lat],1e5,function(i,e){var n=g.q("#crossing");if(e&&e.poiList&&e.poiList.pois&&0<e.poiList.pois.length){var t=e.poiList.pois,a="";t.forEach(function(i){a+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),n.innerHTML=a;new s(".s-crossing",{slidesPerView:"auto",spaceBetween:30})}else n.parentNode.parentNode.parentNode.style.display="none"})})}else console.log("\u83b7\u53d6\u7ecf\u7eac\u5ea6\u5931\u8d25")})})}};g.init()});