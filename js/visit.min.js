require.config({paths:{common:"common.min",swiper:"swiper-bundle.min",jquery:"jquery-3.2.1"}}),define(["common","swiper","jquery"],function(t,i,o){t.init();var a,d={id:t.parseQueryString().id,commentList:[],env:"dev",server:{dev:"//dev.xiangdao.info",pro:"//www.xiangdao.info"}},l=new i(".swiper-houses",{slidesPerView:2.5,spaceBetween:10,init:!1});d.initTab=function(t){var e=document.querySelectorAll(".tab-tit"),n=document.querySelectorAll(".tab-con");e[t].classList.add("sel"),n[t].classList.add("sel")},d.eventBind=function(){o(".tab-tit").on("click",function(){for(var t=o(".tab-con"),e=0;e<t.length;e++)o(this).data("id")===t.eq(e).data("id")?(t.eq(e).addClass("sel"),o(this).addClass("sel").siblings(".tab-tit").removeClass("sel")):t.eq(e).removeClass("sel")}),o(".pan-cols").on("click",function(){o("#content").slideToggle(),o(this).toggleClass("col")}),o(document).off("click").on("click",".cop-more",function(){var i=o(this),a=parseInt(i.data("id")),t=i.data("switch"),e=parseInt(i[0].dataset.page);if("off"===t)d.requestReplyList(a,d.getPageSize(e),i,e);else{var n=d.commentList;n&&0<n.length&&n.forEach(function(t){if(t.commentId===a){var e=t.childCommentCount-t.list.length,n=4<e?5:e;i.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+n+"\u6761\u56de\u590d")}}),i.data("switch","off"),i.find(".cop-more-btn").removeClass("col"),i[0].dataset.page=1,i.prev(".comment-reply").find(".cop-li-add").remove(),n&&0<n.length&&n.forEach(function(t){t.commentId===a&&(t.totalList=t.list)})}}),o(document).on("click",".full-swiper-slide",function(){a.removeAllSlides(),a.updateSlides(),a.destroy(),o("#fullPageImages").hide()}),o(document).on("click",".comment-img,.cop-con-show-img",function(){var t=o(this).data("img").split(","),e=parseInt(o(this).data("index"));if(t&&0<t.length){a=new i("#fullPageImages",{init:!1,initialSlide:e,lazy:{elementClass:"swiper-lazy"}});var n="";t.forEach(function(t){n+='<div class="swiper-slide full-swiper-slide" style="background: url('+t+') no-repeat center / 100%"></div>'}),d.q("#fullPageWrap").innerHTML=n,d.q("#fullPageImages").style.display="block",a.init(),a.update()}})},d.q=function(t){return document.querySelector(t)},d.getPageSize=function(t){parseInt(t);return 5},d.parseDate=function(t){var e=new Date(t);return e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())},d.parseDateForComment=function(t){var e=new Date(t);return(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())},d.pcaFilter=function(t){if(t){return-1<["\u7701","\u5e02","\u533a"].indexOf(t.substr(t.length-1,1))?t.substring(0,t.length-1):t}return""},d.requestReplyList=function(l,t,c,r){o.ajax({url:d.server[d.env]+"/xiangdao-api/api/news/new_comment_child_list",method:"POST",dataType:"json",async:!1,headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({commentId:l,pageSize:t,pageNo:r}),success:function(i){if(console.log(i),0===i.status){var t="",a=i.json.result,n=d.commentList;if(a&&0<a.length){a.forEach(function(e){n.forEach(function(t){l===t.commentId&&t.totalList&&0<t.totalList.length&&t.totalList.forEach(function(t){t.commentId===e.commentId&&(e.hide=!0)})})}),t+=d.renderReplyList(a);var e=c.prev(".comment-reply");0<e.length?e.append(t):c.before('<div class="comment-reply">'+t+"</div>");var s=document.querySelectorAll(".link");if(s&&0<s.length)for(var o=0;o<s.length;o++)s[o].addEventListener("click",function(){openApp()},!1)}n.forEach(function(t){if(t.commentId===l)if(t.totalList=t.totalList.concat(a),t.totalList.length<i.json.totalCount){var e=i.json.totalCount-t.totalList.length+t.list.length,n=4<e?5:e;c.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+n+"\u6761\u56de\u590d"),c.find(".cop-more-btn").removeClass("col"),r++,c[0].dataset.page=r}else c.find(".cop-more-text").text("\u6536\u8d77\u5168\u90e8\u56de\u590d"),c.find(".cop-more-btn").addClass("col"),c.data("switch","on")})}}})},d.renderReplyList=function(t){var e="";return t.forEach(function(t){t.hide||(e+='<div class="cop-li cop-li-add" data-id="'+t.commentId+'">\n            <img class="cop-l" src="'+t.avatar+'" alt />\n            <div class="cop-c">\n                 <div class="cop-name">'+t.nickName+(1===t.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                 <div class="cop-con">\n'+(t.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+t.parentNickName+"</span>\uff1a":"")+(t.content?t.content:""),t.images&&(e+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+t.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),e+='</div>\n                 <div class="cop-fun">\n                      <div class="cop-time">'+d.parseDateForComment(t.createDate)+' \xb7 </div>\n                      <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                      <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                 </div>\n            </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(0<t.likeCount?t.likeCount:"")+"</div></div>       </div>")}),e},d.renderCommentList=function(){var t=d.commentList;if(t&&0<t.length){var s="";t.forEach(function(t){if(s+='<div class="comment-li" data-id="'+t.commentId+'">\n<div class="comment-li-wrap">                        <img class="comment-l" src="'+t.avatar+'" alt />\n                        <div class="comment-c">\n                            <div class="comment-name">'+t.nickName+'</div>\n                            <div class="comment-con">'+(t.content?t.content:"")+"</div>\n",t.images){var e=t.images.split(",");if(e&&0<e.length){for(var n='<div class="comment-imgs">',i=0;i<e.length;i++)n+='<img class="comment-img swiper-lazy" data-index="'+i+'" data-img="'+t.images+'" src="'+e[i]+'" alt />';s+=n+="</div>"}}if(s+='<div class="comment-fun">\n                <div class="comment-time">'+d.parseDateForComment(t.createDate)+' \xb7 </div>\n                <div class="comment-btn-reply link">\u56de\u590dTA</div>\n                <img class="comment-btn-more link" src="img/icon_more_s.png" alt />\n           </div>',s+='</div>\n           <div class="comment-r link">\n               <img class="comment-like-icon" src="img/icon_like_g.png" alt />\n               <div class="comment-like-num">'+(0<t.likeCount?t.likeCount:"")+"</div>\n           </div>\n       </div>",t.totalList&&0<t.totalList.length){var a="";a+='<div class="comment-reply">',t.totalList.forEach(function(t){a+='<div class="cop-li" data-id="'+t.commentId+'">\n              <img class="cop-l" src="'+t.avatar+'" alt />\n              <div class="cop-c">\n                   <div class="cop-name">'+t.nickName+(1===t.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                   <div class="cop-con">\n                        '+(t.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+t.parentNickName+"</span>\uff1a":"")+(t.content?t.content:"")+"\n",t.images&&(a+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+t.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),a+='                   </div>\n                   <div class="cop-fun">\n                        <div class="cop-time">'+d.parseDateForComment(t.createDate)+' \xb7 </div>\n                        <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                        <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                   </div>\n              </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(0<t.likeCount?t.likeCount:"")+"</div></div>         </div>\n"}),s+=a+="</div>"}0<t.childCommentCount-t.totalList.length&&(s+='<div class="cop-more" data-page="1" data-switch="off" data-id="'+t.commentId+'"><span class="cop-more-text">\u70b9\u51fb\u5c55\u5f00'+(4<t.childCommentCount-t.totalList.length?5:t.childCommentCount-t.totalList.length)+'\u6761\u56de\u590d</span><img class="cop-more-btn" src="img/icon_arrow_g2.png" alt /></div>'),o("#commentList").html(s)})}},d.dataInit=function(){t.request({url:d.server[d.env]+"/xiangdao-api/api/news/visit_details/"+d.id,method:"GET",success:function(t){if(console.log(t),0===t.status){var e=t.json;if(e){d.q("#playVideo").src=e.video,d.q("#playVideo").poster=e.cover,d.q("#userAvatar").src=e.userAvatar,d.q("#userNickName").innerText=e.userNickName,d.q("#fansCount").innerText=e.fansCount||0,d.q("#videoCount").innerText=e.videoCount||0,d.q("#title").innerText=e.title,d.q("#location").innerText=d.pcaFilter(e.locationProvinceName)+(e.locationCityName?" \xb7 "+d.pcaFilter(e.locationCityName):""),d.q("#lookNumber").innerText=e.lookNumber,d.q("#likeCount").innerText=0<e.likeCount?e.likeCount:"\u70b9\u8d5e",d.q("#publishDate").innerText=d.parseDate(e.publishDate)+"\u53d1\u5e03";var n=e.tagName.split(",");if(""!==e.tagName&&n&&0<n.length){var i="";n.forEach(function(t){i+='<div class="pan-tag">'+t+"</div>"}),d.q("#tagName").innerHTML=i}else d.q("#tagName").style.display="none";e.content?d.q("#content").innerText=e.content:d.q(".pan-cols").style.display="none",e.locationTown&&o.ajax({url:d.server[d.env]+"/xiangdao-api/api/news/visit_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({code:e.locationTown,pageSize:8}),success:function(t){if(console.log(t),0===t.status){var e=t.json.result;if(e&&0<e.length){var n="";e.forEach(function(t){parseInt(d.id)!==t.visitId&&(n+='<a class="lli" data-id="'+t.visitId+'" href="visit.html?id='+t.visitId+'">\n                                <div class="lli-l">\n                                    <img class="lli-img" src="'+t.cover+'" alt />\n                                    <div class="lli-time">'+t.videoDuration+'</div>\n                                </div>\n                                <div class="lli-r">\n                                    <div class="lli-tit">'+t.title+'</div>\n                                    <div class="lli-stit">'+(t.userNickName?t.userNickName:"")+"<span>"+t.lookNumber+"</span>\u6b21\u89c2\u770b</div>\n                                </div>\n                            </a>")}),""===(d.q("#tales").innerHTML=n)&&(d.q("#relationStory").style.display="none")}else d.q("#relationStory").style.display="none"}else d.q("#relationStory").style.display="none"}});var a=e.list;if(a&&0<a.length){var s="";a.forEach(function(t){s+='<a class="swiper-slide" data-id="'+t.houseId+'" href="house_details.html?houseId='+t.houseId+'">\n             <img class="roll-slide-img" src="'+t.infoCover+'" alt />\n             <div class="roll-slide-stit">'+t.profileStr+'</div>\n             <div class="roll-slide-tit">'+t.infoTitle+"</div>\n         </a>"}),d.q("#houseList").innerHTML=s,l.init(),""===s&&(d.q("#relationHouses").style.display="none")}else d.q("#relationHouses").style.display="none"}}}}),o.ajax({url:d.server[d.env]+"/xiangdao-api/api/news/new_comment_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({bizId:d.id,bizType:6}),success:function(t){if(console.log(t),0===t.status){var e=t.json.result;if((d.commentList=e)&&0<e.length){d.q("#commentNum").innerText=t.json.totalCount,e.forEach(function(t){t.totalList=t.list}),d.renderCommentList();var n=document.querySelectorAll(".link");if(n&&0<n.length)for(var i=0;i<n.length;i++)n[i].addEventListener("click",function(){openApp()},!1)}else{d.q("#comment").innerHTML='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>'}}}})};var e=document.querySelectorAll(".pan-showall");if(e&&0<e.length)for(var n=0;n<e.length;n++)e[n].addEventListener("click",function(){var t=this.previousElementSibling;t&&t.classList.add("showAll"),this.style.display="none"},!1);o(".show-all").on("click",function(){var t=o(this);t.hasClass("cols")?(t.removeClass("cols").find("span").text("\u6536\u8d77"),t.prev(".vp-list").addClass("showAll")):(t.addClass("cols").find("span").text("\u5c55\u5f00"),t.prev(".vp-list").removeClass("showAll"))});var s=document.querySelectorAll(".link");if(s&&0<s.length)for(var c=0;c<s.length;c++)s[c].addEventListener("click",function(){openApp()},!1);d.init=function(){d.initTab(0),d.eventBind(),d.dataInit()},d.init()});