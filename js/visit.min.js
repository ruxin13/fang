require.config({paths:{common:"common.min",swiper:"swiper-bundle.min",jquery:"jquery-3.2.1"}}),define(["common","swiper","jquery"],function(e,i,o){e.init();var a,d={id:e.parseQueryString().id,commentList:[],env:"dev",server:{dev:"//dev.xiangdao.info",pro:"//www.xiangdao.info"}},l=new i(".swiper-houses",{slidesPerView:2.5,spaceBetween:10,init:!1});d.initTab=function(e){var t=document.querySelectorAll(".tab-tit"),n=document.querySelectorAll(".tab-con");t[e].classList.add("sel"),n[e].classList.add("sel")},d.eventBind=function(){o(".tab-tit").on("click",function(){for(var e=o(".tab-con"),t=0;t<e.length;t++)o(this).data("id")===e.eq(t).data("id")?(e.eq(t).addClass("sel"),o(this).addClass("sel").siblings(".tab-tit").removeClass("sel")):e.eq(t).removeClass("sel")}),o(".pan-cols").on("click",function(){o("#content").slideToggle(),o(this).toggleClass("col")}),o(document).off("click").on("click",".cop-more",function(){var i=o(this),a=parseInt(i.data("id")),e=i.data("switch"),t=parseInt(i[0].dataset.page);if("off"===e)d.requestReplyList(a,d.getPageSize(t),i,t);else{var n=d.commentList;n&&0<n.length&&n.forEach(function(e){if(e.commentId===a){var t=e.childCommentCount-e.list.length,n=4<t?5:t;i.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+n+"\u6761\u56de\u590d")}}),i.data("switch","off"),i.find(".cop-more-btn").removeClass("col"),i[0].dataset.page=1,i.prev(".comment-reply").find(".cop-li-add").remove(),n&&0<n.length&&n.forEach(function(e){e.commentId===a&&(e.totalList=e.list)})}}),o(document).on("click",".full-swiper-slide",function(){a.removeAllSlides(),a.updateSlides(),a.destroy(),o("#fullPageImages").hide()}),o(document).on("click",".comment-img,.cop-con-show-img",function(){var e=o(this).data("img").split(","),t=parseInt(o(this).data("index"));if(e&&0<e.length){a=new i("#fullPageImages",{init:!1,initialSlide:t,lazy:{elementClass:"swiper-lazy"}});var n="";e.forEach(function(e){n+='<div class="swiper-slide full-swiper-slide" style="background: url('+e+') no-repeat center / 100%"></div>'}),d.q("#fullPageWrap").innerHTML=n,d.q("#fullPageImages").style.display="block",a.init(),a.update()}})},d.q=function(e){return document.querySelector(e)},d.getPageSize=function(e){parseInt(e);return 5},d.parseDate=function(e){var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())},d.parseDateForComment=function(e){var t=new Date(e);return(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())},d.requestReplyList=function(l,e,c,r){o.ajax({url:d.server[d.env]+"/xiangdao-api/api/news/new_comment_child_list",method:"POST",dataType:"json",async:!1,headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({commentId:l,pageSize:e,pageNo:r}),success:function(i){if(console.log(i),0===i.status){var e="",a=i.json.result,n=d.commentList;if(a&&0<a.length){a.forEach(function(t){n.forEach(function(e){l===e.commentId&&e.totalList&&0<e.totalList.length&&e.totalList.forEach(function(e){e.commentId===t.commentId&&(t.hide=!0)})})}),e+=d.renderReplyList(a);var t=c.prev(".comment-reply");0<t.length?t.append(e):c.before('<div class="comment-reply">'+e+"</div>");var s=document.querySelectorAll(".link");if(s&&0<s.length)for(var o=0;o<s.length;o++)s[o].addEventListener("click",function(){openApp()},!1)}n.forEach(function(e){if(e.commentId===l)if(e.totalList=e.totalList.concat(a),e.totalList.length<i.json.totalCount){var t=i.json.totalCount-e.totalList.length+e.list.length,n=4<t?5:t;c.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+n+"\u6761\u56de\u590d"),c.find(".cop-more-btn").removeClass("col"),r++,c[0].dataset.page=r}else c.find(".cop-more-text").text("\u6536\u8d77\u5168\u90e8\u56de\u590d"),c.find(".cop-more-btn").addClass("col"),c.data("switch","on")})}}})},d.renderReplyList=function(e){var t="";return e.forEach(function(e){e.hide||(t+='<div class="cop-li cop-li-add" data-id="'+e.commentId+'">\n            <img class="cop-l" src="'+e.avatar+'" alt />\n            <div class="cop-c">\n                 <div class="cop-name">'+e.nickName+(1===e.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                 <div class="cop-con">\n'+(e.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+e.parentNickName+"</span>\uff1a":"")+(e.content?e.content:""),e.images&&(t+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+e.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),t+='</div>\n                 <div class="cop-fun">\n                      <div class="cop-time">'+d.parseDateForComment(e.createDate)+' \xb7 </div>\n                      <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                      <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                 </div>\n            </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(0<e.likeCount?e.likeCount:"")+"</div></div>       </div>")}),t},d.renderCommentList=function(){var e=d.commentList;if(e&&0<e.length){var s="";e.forEach(function(e){if(s+='<div class="comment-li" data-id="'+e.commentId+'">\n<div class="comment-li-wrap">                        <img class="comment-l" src="'+e.avatar+'" alt />\n                        <div class="comment-c">\n                            <div class="comment-name">'+e.nickName+'</div>\n                            <div class="comment-con">'+(e.content?e.content:"")+"</div>\n",e.images){var t=e.images.split(",");if(t&&0<t.length){for(var n='<div class="comment-imgs">',i=0;i<t.length;i++)n+='<img class="comment-img swiper-lazy" data-index="'+i+'" data-img="'+e.images+'" src="'+t[i]+'" alt />';s+=n+="</div>"}}if(s+='<div class="comment-fun">\n                <div class="comment-time">'+d.parseDateForComment(e.createDate)+' \xb7 </div>\n                <div class="comment-btn-reply link">\u56de\u590dTA</div>\n                <img class="comment-btn-more link" src="img/icon_more_s.png" alt />\n           </div>',s+='</div>\n           <div class="comment-r link">\n               <img class="comment-like-icon" src="img/icon_like_g.png" alt />\n               <div class="comment-like-num">'+(0<e.likeCount?e.likeCount:"")+"</div>\n           </div>\n       </div>",e.totalList&&0<e.totalList.length){var a="";a+='<div class="comment-reply">',e.totalList.forEach(function(e){a+='<div class="cop-li" data-id="'+e.commentId+'">\n              <img class="cop-l" src="'+e.avatar+'" alt />\n              <div class="cop-c">\n                   <div class="cop-name">'+e.nickName+(1===e.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                   <div class="cop-con">\n                        '+(e.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+e.parentNickName+"</span>\uff1a":"")+(e.content?e.content:"")+"\n",e.images&&(a+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+e.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),a+='                   </div>\n                   <div class="cop-fun">\n                        <div class="cop-time">'+d.parseDateForComment(e.createDate)+' \xb7 </div>\n                        <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                        <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                   </div>\n              </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(0<e.likeCount?e.likeCount:"")+"</div></div>         </div>\n"}),s+=a+="</div>"}0<e.childCommentCount-e.totalList.length&&(s+='<div class="cop-more" data-page="1" data-switch="off" data-id="'+e.commentId+'"><span class="cop-more-text">\u70b9\u51fb\u5c55\u5f00'+(4<e.childCommentCount-e.totalList.length?5:e.childCommentCount-e.totalList.length)+'\u6761\u56de\u590d</span><img class="cop-more-btn" src="img/icon_arrow_g2.png" alt /></div>'),o("#commentList").html(s)})}},d.dataInit=function(){e.request({url:d.server[d.env]+"/xiangdao-api/api/news/visit_details/"+d.id,method:"GET",success:function(e){if(console.log(e),0===e.status){var t=e.json;if(t){d.q("#playVideo").src=t.video,d.q("#playVideo").poster=t.cover,d.q("#userAvatar").src=t.userAvatar,d.q("#userNickName").innerText=t.userNickName,d.q("#fansCount").innerText=t.fansCount||0,d.q("#videoCount").innerText=t.videoCount||0,d.q("#title").innerText=t.title,d.q("#location").innerText=t.locationProvinceName+t.locationCityName,d.q("#lookNumber").innerText=t.lookNumber,d.q("#likeCount").innerText=0<t.likeCount?t.likeCount:"\u70b9\u8d5e",d.q("#publishDate").innerText=d.parseDate(t.publishDate)+"\u53d1\u5e03";var n=t.tagName.split(",");if(""!==t.tagName&&n&&0<n.length){var i="";n.forEach(function(e){i+='<div class="pan-tag">'+e+"</div>"}),d.q("#tagName").innerHTML=i}else d.q("#tagName").style.display="none";t.content?d.q("#content").innerText=t.content:d.q(".pan-cols").style.display="none",t.locationTown&&o.ajax({url:d.server[d.env]+"/xiangdao-api/api/news/visit_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({code:t.locationTown,pageSize:8}),success:function(e){if(console.log(e),0===e.status){var t=e.json.result;if(t&&0<t.length){var n="";t.forEach(function(e){parseInt(d.id)!==e.visitId&&(n+='<a class="lli" data-id="'+e.visitId+'" href="visit.html?id='+e.visitId+'">\n                                <div class="lli-l">\n                                    <img class="lli-img" src="'+e.cover+'" alt />\n                                    <div class="lli-time">'+e.videoDuration+'</div>\n                                </div>\n                                <div class="lli-r">\n                                    <div class="lli-tit">'+e.title+'</div>\n                                    <div class="lli-stit">'+(e.userNickName?e.userNickName:"")+"<span>"+e.lookNumber+"</span>\u6b21\u89c2\u770b</div>\n                                </div>\n                            </a>")}),""===(d.q("#tales").innerHTML=n)&&(d.q("#relationStory").style.display="none")}else d.q("#relationStory").style.display="none"}else d.q("#relationStory").style.display="none"}});var a=t.list;if(a&&0<a.length){var s="";a.forEach(function(e){s+='<a class="swiper-slide" data-id="'+e.houseId+'" href="house_details.html?houseId='+e.houseId+'">\n             <img class="roll-slide-img" src="'+e.infoCover+'" alt />\n             <div class="roll-slide-stit">'+e.profileStr+'</div>\n             <div class="roll-slide-tit">'+e.infoTitle+"</div>\n         </a>"}),d.q("#houseList").innerHTML=s,l.init(),""===s&&(d.q("#relationHouses").style.display="none")}else d.q("#relationHouses").style.display="none"}}}}),o.ajax({url:d.server[d.env]+"/xiangdao-api/api/news/new_comment_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({bizId:d.id,bizType:6}),success:function(e){if(console.log(e),0===e.status){var t=e.json.result;if((d.commentList=t)&&0<t.length){d.q("#commentNum").innerText=e.json.totalCount,t.forEach(function(e){e.totalList=e.list}),d.renderCommentList();var n=document.querySelectorAll(".link");if(n&&0<n.length)for(var i=0;i<n.length;i++)n[i].addEventListener("click",function(){openApp()},!1)}else{d.q("#comment").innerHTML='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>'}}}})};var t=document.querySelectorAll(".pan-showall");if(t&&0<t.length)for(var n=0;n<t.length;n++)t[n].addEventListener("click",function(){var e=this.previousElementSibling;e&&e.classList.add("showAll"),this.style.display="none"},!1);o(".show-all").on("click",function(){var e=o(this);e.hasClass("cols")?(e.removeClass("cols").find("span").text("\u6536\u8d77"),e.prev(".vp-list").addClass("showAll")):(e.addClass("cols").find("span").text("\u5c55\u5f00"),e.prev(".vp-list").removeClass("showAll"))});var s=document.querySelectorAll(".link");if(s&&0<s.length)for(var c=0;c<s.length;c++)s[c].addEventListener("click",function(){openApp()},!1);d.init=function(){d.initTab(0),d.eventBind(),d.dataInit()},d.init()});