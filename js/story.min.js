require.config({paths:{common:"common.min",swiper:"swiper-bundle.min",jquery:"jquery-3.2.1"}}),define(["common","swiper","jquery"],function(t,e,n){t.init();var i,a={id:t.parseQueryString().id,commentList:[],env:"dev",server:{dev:"//dev.xiangdao.info",pro:"//www.xiangdao.info"}},s=new e(".swiper-houses",{slidesPerView:2.5,spaceBetween:10,init:!1});a.initTab=function(t){var e=document.querySelectorAll(".tab-tit"),n=document.querySelectorAll(".tab-con");e[t].classList.add("sel"),n[t].classList.add("sel")},a.eventBind=function(){n(".tab-tit").on("click",function(){for(var t=n(".tab-con"),e=0;e<t.length;e++)n(this).data("id")===t.eq(e).data("id")?(t.eq(e).addClass("sel"),n(this).addClass("sel").siblings(".tab-tit").removeClass("sel")):t.eq(e).removeClass("sel")}),n(".pan-cols").on("click",function(){n("#content").slideToggle(),n(this).toggleClass("col")}),n(document).off("click").on("click",".cop-more",function(){var t=n(this),e=parseInt(t.data("id")),i=t.data("switch"),s=parseInt(t[0].dataset.page);if("off"===i)a.requestReplyList(e,a.getPageSize(s),t,s);else{var o=a.commentList;o&&o.length>0&&o.forEach(function(n){if(n.commentId===e){var i=n.childCommentCount-n.list.length,a=i>4?5:i;t.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+a+"\u6761\u56de\u590d")}}),t.data("switch","off"),t.find(".cop-more-btn").removeClass("col"),t[0].dataset.page=1,t.prev(".comment-reply").find(".cop-li-add").remove(),o&&o.length>0&&o.forEach(function(t){t.commentId===e&&(t.totalList=t.list)})}}),n(document).on("click",".full-swiper-slide",function(){i.removeAllSlides(),i.updateSlides(),i.destroy(),n("#fullPageImages").hide()}),n(document).on("click",".comment-img,.cop-con-show-img",function(){var t=n(this).data("img").split(","),s=parseInt(n(this).data("index"));if(t&&t.length>0){i=new e("#fullPageImages",{init:!1,initialSlide:s,lazy:{elementClass:"swiper-lazy"}});var o="";t.forEach(function(t){o+='<div class="swiper-slide full-swiper-slide" style="background: url('+t+') no-repeat center / 100%"></div>'}),a.q("#fullPageWrap").innerHTML=o,a.q("#fullPageImages").style.display="block",i.init(),i.update()}})},a.q=function(t){return document.querySelector(t)},a.getPageSize=function(t){parseInt(t);return 5},a.parseDate=function(t){var e=new Date(t);return e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())},a.parseDateForComment=function(t){var e=new Date(t);return(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())},a.requestReplyList=function(t,e,i,s){n.ajax({url:a.server[a.env]+"/xiangdao-api/api/news/new_comment_child_list",method:"POST",dataType:"json",async:!1,headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({commentId:t,pageSize:e,pageNo:s}),success:function(e){if(0===e.status){var n="",o=e.json.result,l=a.commentList;if(o&&o.length>0){o.forEach(function(e){l.forEach(function(n){t===n.commentId&&n.totalList&&n.totalList.length>0&&n.totalList.forEach(function(t){t.commentId===e.commentId&&(e.hide=!0)})})}),n+=a.renderReplyList(o);var c=i.prev(".comment-reply");c.length>0?c.append(n):i.before('<div class="comment-reply">'+n+"</div>");var d=document.querySelectorAll(".link");if(d&&d.length>0)for(var r=0;r<d.length;r++)d[r].addEventListener("click",function(){openApp()},!1)}l.forEach(function(n){if(n.commentId===t)if(n.totalList=n.totalList.concat(o),n.totalList.length<e.json.totalCount){var a=e.json.totalCount-n.totalList.length+n.list.length,l=a>4?5:a;i.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+l+"\u6761\u56de\u590d"),i.find(".cop-more-btn").removeClass("col"),s++,i[0].dataset.page=s}else i.find(".cop-more-text").text("\u6536\u8d77\u5168\u90e8\u56de\u590d"),i.find(".cop-more-btn").addClass("col"),i.data("switch","on")})}}})},a.renderReplyList=function(t){var e="";return t.forEach(function(t){t.hide||(e+='<div class="cop-li cop-li-add" data-id="'+t.commentId+'">\n            <img class="cop-l" src="'+t.avatar+'" alt />\n            <div class="cop-c">\n                 <div class="cop-name">'+t.nickName+(1===t.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                 <div class="cop-con">\n'+(t.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+t.parentNickName+"</span>\uff1a":"")+(t.content?t.content:""),t.images&&(e+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+t.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),e+='</div>\n                 <div class="cop-fun">\n                      <div class="cop-time">'+a.parseDateForComment(t.createDate)+' \xb7 </div>\n                      <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                      <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                 </div>\n            </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(t.likeCount>0?t.likeCount:"")+"</div></div>       </div>")}),e},a.renderCommentList=function(){var t=a.commentList;if(t&&t.length>0){var e="";t.forEach(function(t){if(e+='<div class="comment-li" data-id="'+t.commentId+'">\n<div class="comment-li-wrap">                        <img class="comment-l" src="'+t.avatar+'" alt />\n                        <div class="comment-c">\n                            <div class="comment-name">'+t.nickName+'</div>\n                            <div class="comment-con">'+(t.content?t.content:"")+"</div>\n",t.images){var i=t.images.split(",");if(i&&i.length>0){for(var s='<div class="comment-imgs">',o=0;o<i.length;o++)s+='<img class="comment-img swiper-lazy" data-index="'+o+'" data-img="'+t.images+'" src="'+i[o]+'" alt />';e+=s+="</div>"}}if(e+='<div class="comment-fun">\n                <div class="comment-time">'+a.parseDateForComment(t.createDate)+' \xb7 </div>\n                <div class="comment-btn-reply link">\u56de\u590dTA</div>\n                <img class="comment-btn-more link" src="img/icon_more_s.png" alt />\n           </div>',e+='</div>\n           <div class="comment-r link">\n               <img class="comment-like-icon" src="img/icon_like_g.png" alt />\n               <div class="comment-like-num">'+(t.likeCount>0?t.likeCount:"")+"</div>\n           </div>\n       </div>",t.totalList&&t.totalList.length>0){var l="";l+='<div class="comment-reply">',t.totalList.forEach(function(t){l+='<div class="cop-li" data-id="'+t.commentId+'">\n              <img class="cop-l" src="'+t.avatar+'" alt />\n              <div class="cop-c">\n                   <div class="cop-name">'+t.nickName+(1===t.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                   <div class="cop-con">\n                        '+(t.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+t.parentNickName+"</span>\uff1a":"")+(t.content?t.content:"")+"\n",t.images&&(l+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+t.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),l+='                   </div>\n                   <div class="cop-fun">\n                        <div class="cop-time">'+a.parseDateForComment(t.createDate)+' \xb7 </div>\n                        <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                        <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                   </div>\n              </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(t.likeCount>0?t.likeCount:"")+"</div></div>         </div>\n"}),e+=l+="</div>"}t.childCommentCount-t.totalList.length>0&&(e+='<div class="cop-more" data-page="1" data-switch="off" data-id="'+t.commentId+'"><span class="cop-more-text">\u70b9\u51fb\u5c55\u5f00'+(t.childCommentCount-t.totalList.length>4?5:t.childCommentCount-t.totalList.length)+'\u6761\u56de\u590d</span><img class="cop-more-btn" src="img/icon_arrow_g2.png" alt /></div>'),n("#commentList").html(e)})}},a.dataInit=function(){t.request({url:a.server[a.env]+"/xiangdao-api/api/news/tale_details/"+a.id,method:"GET",success:function(t){if(0===t.status){var e=t.json;if(e){a.q("#playVideo").src=e.video,a.q("#playVideo").poster=e.cover,a.q("#title").innerText=e.title,a.q("#location").innerText=e.locationCityName+"\xb7"+e.locationTownName,a.q("#lookNumber").innerText=e.lookNumber,a.q("#likeCount").innerText=e.likeCount>0?e.likeCount:"\u70b9\u8d5e",a.q("#publishDate").innerText=a.parseDate(e.publishDate)+"\u53d1\u5e03";var i=e.tagName.split(",");if(""!==e.tagName&&i&&i.length>0){var s="";i.forEach(function(t){s+='<div class="pan-tag">'+t+"</div>"}),a.q("#tagName").innerHTML=s}else a.q("#tagName").style.display="none";e.content?a.q("#content").innerText=e.content:a.q(".pan-cols").style.display="none",e.locationTown&&n.ajax({url:a.server[a.env]+"/xiangdao-api/api/news/tale_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({code:e.locationTown,pageSize:20}),success:function(t){if(0===t.status){var e=t.json.result;if(e&&e.length>0){var n="";e.forEach(function(t){parseInt(a.id)!==t.taleId&&(n+='<a class="lli" data-id="'+t.taleId+'" href="story.html?id='+t.taleId+'">\n                                <div class="lli-l">\n                                    <img class="lli-img" src="'+t.cover+'" alt />\n                                    <div class="lli-time">'+t.videoDuration+'</div>\n                                </div>\n                                <div class="lli-r">\n                                    <div class="lli-tit">'+t.title+'</div>\n                                    <div class="lli-stit">'+(t.userNickName?t.userNickName:"")+"<span>"+t.lookNumber+"</span>\u6b21\u89c2\u770b</div>\n                                </div>\n                            </a>")}),a.q("#tales").innerHTML=n,""===n&&(a.q("#relationStory").style.display="none")}else a.q("#relationStory").style.display="none"}else a.q("#relationStory").style.display="none"}})}}}}),t.request({url:a.server[a.env]+"/xiangdao-api/api/news/tale/"+a.id+"/house_list",method:"GET",success:function(t){if(0===t.status){var e=t.json;if(e&&e.length>0){var n="";e.forEach(function(t){n+='<a class="swiper-slide" data-id="'+t.houseId+'" href="house_details.html?houseId='+t.houseId+'">\n             <img class="roll-slide-img" src="'+t.infoCover+'" alt />\n             <div class="roll-slide-stit">'+t.profileStr+'</div>\n             <div class="roll-slide-tit">'+t.infoTitle+"</div>\n         </a>"}),a.q("#houseList").innerHTML=n,s.init(),""===n&&(a.q("#relationHouses").style.display="none")}else a.q("#relationHouses").style.display="none"}else a.q("#relationHouses").style.display="none"}}),n.ajax({url:a.server[a.env]+"/xiangdao-api/api/news/new_comment_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({bizId:a.id,bizType:5}),success:function(t){if(0===t.status){var e=t.json.result;if(a.commentList=e,e&&e.length>0){a.q("#commentNum").innerText=t.json.totalCount,e.forEach(function(t){t.totalList=t.list}),a.renderCommentList();var n=document.querySelectorAll(".link");if(n&&n.length>0)for(var i=0;i<n.length;i++)n[i].addEventListener("click",function(){openApp()},!1)}else{'<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>',a.q("#comment").innerHTML='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>'}}}})};var o=document.querySelectorAll(".pan-showall");if(o&&o.length>0)for(var l=0;l<o.length;l++)o[l].addEventListener("click",function(){var t=this.previousElementSibling;t&&t.classList.add("showAll"),this.style.display="none"},!1);n(".show-all").on("click",function(){var t=n(this);t.hasClass("cols")?(t.removeClass("cols").find("span").text("\u6536\u8d77"),t.prev(".vp-list").addClass("showAll")):(t.addClass("cols").find("span").text("\u5c55\u5f00"),t.prev(".vp-list").removeClass("showAll"))});var c=document.querySelectorAll(".link");if(c&&c.length>0)for(var d=0;d<c.length;d++)c[d].addEventListener("click",function(){openApp()},!1);a.init=function(){a.initTab(0),a.eventBind(),a.dataInit()},a.init()});