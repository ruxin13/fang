require.config({paths:{common:"common.min",swiper:"swiper.min",jquery:"jquery-3.2.1",amap:"https://webapi.amap.com/maps?v=2.0&key=1acf89333f048989b606d856cba42d2d&callback=onAMapLoaded"}}),define(["common","swiper","jquery"],function(i,e,n){i.init();var t={env:"dev",server:{dev:"//dev.xiangdao.info",pro:"//www.xiangdao.info"},parseDate:function(i){var e=new Date(i);return(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())},swapArray:function(i,e,n){return i[e]=i.splice(n,1,i[e])[0],i},q:function(i){return document.querySelector(i)}};t.id=i.parseQueryString().id;var a=new e(".swiper-album",{slidesPerView:2.5,spaceBetween:20,init:!1});i.request({url:t.server[t.env]+"/xiangdao-api/api/news/village_details/"+t.id,method:"GET",success:function(e){var s=e.json;t.locationCity=s.locationCity,t.locationDetail=s.locationDetail;var l=t.q("#playVideo"),o=t.q("#imgList"),r=t.q(".contentTitle"),c=t.q(".contentSTitle"),d=t.q(".contentContent"),v=t.q("#likeCount");if(l.src=s.video,l.poster=s.videoGif,s.briefImages){var p=s.briefImages.split(",");if(p&&p.length>0){var g="";p.forEach(function(i){g+='<div class="swiper-slide album-li" style="background-image: url('+i+')"></div>'}),o.innerHTML=g,a.init()}}r.innerText=s.villageName,c.innerText=s.lookNumber?s.lookNumber+"\u4eba\u89c2\u770b":"",v.innerText=s.likeCount,d.innerHTML=s.content,s.villageId&&n.ajax({url:t.server[t.env]+"/xiangdao-api/api/house/house_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({villageId:s.villageId,pageSize:20}),success:function(i){if(0===i.status){var e=i.json.result;if(e&&e.length>0){var a="";e.forEach(function(i){a+='<div class="vp-li" data-id="'+i.houseId+'">\n                <img class="vp-l" src="'+i.infoCover+'" alt />\n                <div class="vp-r">\n                    <div class="vp-st">'+i.profileStr+'</div>\n                    <div class="vp-ti">'+i.infoTitle+'</div>\n                    <div class="vp-price"><span>\uffe5<i>'+i.ruleMonthMoney+"</i></span>/\u6708</div>\n                </div>\n            </div>"}),t.q(".vp-list").innerHTML=a,1===e.length?(t.q(".vp-list").style.height="2.32rem",t.q(".show-all").style.display="none"):2===e.length?(t.q(".show-all").style.display="none",t.q(".vp-list").style.height="5.6rem"):t.q(".vp-list").style.height="5.6rem",n(".vp-li").on("click",function(){var i=n(this).data("id");location.href="house_details.html?houseId="+i})}else t.q(".vp-wrap").style.display="none"}}}),s.villageIcon?i.request({url:t.server[t.env]+"/xiangdao-api/api/houseEditor/get_house_icon_group",success:function(i){var e=i.json;if(e&&e.length>0){var a="",l=s.villageIcon.split(",");(e=t.swapArray(e,0,1)).forEach(function(i){a+='<div class="ist" data-id="'+i.type+'">\n                <div class="ist-l">\n                    <img class="ist-icon" src="'+i.typeUrl+'" alt/>\n                    <div class="ist-text">'+i.typeName+'</div>\n                </div>\n                <div class="ist-r">\n';var e="";i.list.forEach(function(n){var t=!1;l&&l.length>0&&l.forEach(function(e){var a=e.split("-");a[0]==i.type&&a[1]==n.iconSeq&&(t=!0)}),t&&(e+='<div class="ist-li '+(t?"sel":"")+'" data-id="'+n.iconSeq+'">'+n.iconName+"</div>")}),a+=e,a+="</div></div>"});var o=t.q("#insWrap");o.innerHTML=a;var r=document.querySelectorAll(".ist"),c=[];if(r&&r.length>0){for(var d=0;d<r.length;d++){0===n(r[d]).find(".ist-li").length&&c.push(n(".ist").eq(d))}c.length>0&&c.forEach(function(i){i.remove()});var v=0,p=o.querySelectorAll(".ist");p.length<4&&n("#insMore").hide(),[2,3,5].forEach(function(i){p.forEach(function(e){i===parseInt(e.dataset.id)&&(v+=e.clientHeight)})}),o.style.height=v+"px"}else n("#insMore").parents(".pan").hide()}}}):n("#insMore").parents(".pan").hide(),n.ajax({url:t.server[t.env]+"/xiangdao-api/api/news/comment_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({bizId:parseInt(t.id),bizType:1,pageNo:1}),success:function(i){var e=i.json.result,n="";e&&e.length>0?(t.q("#totalCount").innerText=" \xb7 "+i.json.totalCount,e.forEach(function(i){var e="",a="",s="";if(i.images){e+='<div class="cli-imgs">\n';var l=i.images.split(",");l&&l.length>0&&l.forEach(function(i){e+='<img class="cli-img" src="'+i+'" alt />'}),e+="</div>\n"}i.list&&i.list.length>0&&(a+='<div class="cli-reply">\n',i.list.forEach(function(i){a+='                        <div class="clr-li">\n                            <img class="clr-l" src="'+i.avatar+'" alt />\n                            <div class="clr-r">\n                                <div class="clr-name">'+i.nickName+'</div>\n                                <div class="clr-cont">'+(i.parentNickName?"\u56de\u590d"+i.parentNickName+": ":"")+i.content+'</div>\n                                <div class="clr-fun">\n                                    <div class="clr-fl">'+t.parseDate(i.createDate)+'</div>\n                                    <div class="clr-fr">\n                                        <div class="clrr-li link">\n                                            <img class="clrr-icon" src="img/icon_reply.png" alt />\n                                            <div class="clrr-text">\u56de\u590d</div>\n                                        </div>\n                                        <div class="clrr-li link">\n                                            <img class="clrr-icon" src="img/praise.png" alt />\n                                            <div class="clrr-text">'+(i.isLike?"\u5df2\u70b9\u8d5e":"\u70b9\u8d5e")+"</div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n"}),a+="                    </div>"),s+='<div class="cli-fun">\n                        <div class="cf-l">'+t.parseDate(i.createDate)+'</div>\n                        <div class="cf-r">\n                            <div class="cf-ri link">\n                                <img class="cfr-icon" src="img/icon_reply.png" alt />\n                                <div class="cfr-text">'+(i.childCommentCount?i.childCommentCount:"\u56de\u590d")+'</div>\n                            </div>\n                            <div class="cf-ri link">\n                                <img class="cfr-icon" src="img/praise.png" alt />\n                                <div class="cfr-text">'+(i.likeCount?i.likeCount:"\u70b9\u8d5e")+"</div>\n                            </div>\n                        </div>\n                    </div>",n+='<div class="cli">\n                <img class="cli-l" src="'+i.avatar+'" alt />\n                <div class="cli-r">\n                    <div class="cli-name">'+i.nickName+'<img class="cli-report link" src="img/icon_alarm.png" alt /></div>\n                    <div class="cli-txt">'+i.content+"</div>\n"+e+a+s+"                </div>\n            </div>"})):n+='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>',t.q(".com-list").innerHTML=n;var a=document.querySelectorAll(".link");if(a&&a.length>0)for(var s=0;s<a.length;s++)a[s].addEventListener("click",function(){openApp()},!1)}})}});var s=document.querySelectorAll(".pan-showall");if(s&&s.length>0)for(var l=0;l<s.length;l++)s[l].addEventListener("click",function(){var i=this.previousElementSibling;i&&i.classList.add("showAll"),this.style.display="none"},!1);n(".show-all").on("click",function(){var i=n(this);i.hasClass("cols")?(i.removeClass("cols").find("span").text("\u6536\u8d77"),i.prev(".vp-list").addClass("showAll")):(i.addClass("cols").find("span").text("\u5c55\u5f00"),i.prev(".vp-list").removeClass("showAll"))});var o=document.querySelectorAll(".link");if(o&&o.length>0)for(var r=0;r<o.length;r++)o[r].addEventListener("click",function(){openApp()},!1);window.onAMapLoaded=function(){var i=new AMap.Map("mapContainer",{zoom:11});(new AMap.Geocoder).getLocation(t.locationDetail,function(n,a){if("complete"===n&&a.geocodes.length){var s=a.geocodes[0].location;i.setCenter([s.lng,s.lat]),t.lng=s.lng,t.lat=s.lat;var l=new AMap.Marker({icon:"../img/pos.png",position:[s.lng,s.lat],anchor:"bottom-center"});i.add(l),AMap.plugin(["AMap.PlaceSearch"],function(){var i=new AMap.PlaceSearch({pageSize:6,pageIndex:1,datatype:"poi",city:t.locationCity,citylimit:!0,autoFitView:!0});i.searchNearBy("\u706b\u8f66\u7ad9",[s.lng,s.lat],1e5,function(i,n){var a=t.q("#railwayStation");if(n&&n.poiList&&n.poiList.pois&&n.poiList.pois.length>0){var s=n.poiList.pois,l="";s.forEach(function(i){l+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),a.innerHTML=l;new e(".s-crh",{slidesPerView:"auto",spaceBetween:30})}else a.parentNode.parentNode.parentNode.style.display="none"}),i.searchNearBy("\u6c7d\u8f66\u7ad9",[s.lng,s.lat],1e5,function(i,n){var a=t.q("#busStation");if(n&&n.poiList&&n.poiList.pois&&n.poiList.pois.length>0){var s=n.poiList.pois,l="";s.forEach(function(i){l+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),a.innerHTML=l;new e(".s-bus",{slidesPerView:"auto",spaceBetween:30})}else a.parentNode.parentNode.parentNode.style.display="none"}),i.searchNearBy("\u9ad8\u901f\u8def\u53e3",[s.lng,s.lat],1e5,function(i,n){var a=t.q("#crossing");if(n&&n.poiList&&n.poiList.pois&&n.poiList.pois.length>0){var s=n.poiList.pois,l="";s.forEach(function(i){l+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),a.innerHTML=l;new e(".s-crossing",{slidesPerView:"auto",spaceBetween:30})}else a.parentNode.parentNode.parentNode.style.display="none"})})}})},require(["amap"])});