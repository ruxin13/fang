require.config({paths:{common:"common.min",swiper:"swiper.min",jquery:"jquery-3.2.1",amap:"https://webapi.amap.com/maps?v=2.0&key=1acf89333f048989b606d856cba42d2d&callback=onAMapLoaded"}}),define(["common","swiper","jquery"],function(r,s,v){r.init();var p={env:"dev",server:{dev:"//dev.xiangdao.info",pro:"//www.xiangdao.info"},parseDate:function(i){var e=new Date(i);return(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())},swapArray:function(i,e,n){return i[e]=i.splice(n,1,i[e])[0],i},q:function(i){return document.querySelector(i)}};p.id=r.parseQueryString().id;var g=new s(".swiper-album",{slidesPerView:2.5,spaceBetween:20,init:!1});r.request({url:p.server[p.env]+"/xiangdao-api/api/news/village_details/"+p.id,method:"GET",success:function(i){console.log(i);var d=i.json;p.locationCity=d.locationCity,p.locationDetail=d.locationDetail,p.locationProvinceName=d.locationProvinceName,p.locationCityName=d.locationCityName,p.locationTownName=d.locationTownName;var e=p.q("#playVideo"),n=p.q("#imgList"),a=p.q(".contentTitle"),t=p.q(".contentSTitle"),s=p.q(".contentContent"),l=p.q("#likeCount");if(e.src=d.video,e.poster=d.videoGif,d.briefImages){var o=d.briefImages.split(",");if(o&&0<o.length){var c="";o.forEach(function(i){c+='<div class="swiper-slide album-li" style="background-image: url('+i+')"></div>'}),n.innerHTML=c,g.init()}}a.innerText=d.villageName,t.innerText=d.lookNumber?d.lookNumber+"\u4eba\u89c2\u770b":"",l.innerText=d.likeCount,s.innerHTML=d.content,d.villageId&&v.ajax({url:p.server[p.env]+"/xiangdao-api/api/house/house_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({villageId:d.villageId,pageSize:20}),success:function(i){if(console.log(i),0===i.status){var e=i.json.result;if(e&&0<e.length){var n="";e.forEach(function(i){n+='<div class="vp-li" data-id="'+i.houseId+'">\n                <img class="vp-l" src="'+i.infoCover+'" alt />\n                <div class="vp-r">\n                    <div class="vp-st">'+i.profileStr+'</div>\n                    <div class="vp-ti">'+i.infoTitle+'</div>\n                    <div class="vp-price"><span>\uffe5<i>'+i.ruleMonthMoney+"</i></span>/\u6708</div>\n                </div>\n            </div>"}),p.q(".vp-list").innerHTML=n,1===e.length?(p.q(".vp-list").style.height="2.32rem",p.q(".show-all").style.display="none"):(2===e.length&&(p.q(".show-all").style.display="none"),p.q(".vp-list").style.height="5.6rem"),v(".vp-li").on("click",function(){var i=v(this).data("id");location.href="house_details.html?houseId="+i})}else p.q(".vp-wrap").style.display="none"}}}),d.villageIcon?r.request({url:p.server[p.env]+"/xiangdao-api/api/houseEditor/get_house_icon_group",success:function(i){console.log(i);var e=i.json;if(e&&0<e.length){var n="",s=d.villageIcon.split(",");(e=p.swapArray(e,0,1)).forEach(function(t){n+='<div class="ist" data-id="'+t.type+'">\n                <div class="ist-l">\n                    <img class="ist-icon" src="'+t.typeUrl+'" alt/>\n                    <div class="ist-text">'+t.typeName+'</div>\n                </div>\n                <div class="ist-r">\n';var i="";t.list.forEach(function(n){var a=!1;s&&0<s.length&&s.forEach(function(i){var e=i.split("-");e[0]==t.type&&e[1]==n.iconSeq&&(a=!0)}),a&&(i+='<div class="ist-li '+(a?"sel":"")+'" data-id="'+n.iconSeq+'">'+n.iconName+"</div>")}),n+=i,n+="</div></div>"});var a=p.q("#insWrap");a.innerHTML=n;var t=document.querySelectorAll(".ist"),l=[];if(t&&0<t.length){for(var o=0;o<t.length;o++){0===v(t[o]).find(".ist-li").length&&l.push(v(".ist").eq(o))}0<l.length&&l.forEach(function(i){i.remove()});var c=0,r=a.querySelectorAll(".ist");r.length<4&&v("#insMore").hide(),[2,3,5].forEach(function(e){r.forEach(function(i){e===parseInt(i.dataset.id)&&(c+=i.clientHeight)})}),a.style.height=c+"px",console.log(c)}else v("#insMore").parents(".pan").hide()}}}):v("#insMore").parents(".pan").hide(),v.ajax({url:p.server[p.env]+"/xiangdao-api/api/news/comment_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({bizId:parseInt(p.id),bizType:1,pageNo:1}),success:function(i){console.log(i);var e=i.json.result,s="";e&&0<e.length?(p.q("#totalCount").innerText=" \xb7 "+i.json.totalCount,e.forEach(function(i){var e="",n="",a="";if(i.images){e+='<div class="cli-imgs">\n';var t=i.images.split(",");t&&0<t.length&&t.forEach(function(i){e+='<img class="cli-img" src="'+i+'" alt />'}),e+="</div>\n"}i.list&&0<i.list.length&&(n+='<div class="cli-reply">\n',i.list.forEach(function(i){n+='                        <div class="clr-li">\n                            <img class="clr-l" src="'+i.avatar+'" alt />\n                            <div class="clr-r">\n                                <div class="clr-name">'+i.nickName+'</div>\n                                <div class="clr-cont">'+(i.parentNickName?"\u56de\u590d"+i.parentNickName+": ":"")+i.content+'</div>\n                                <div class="clr-fun">\n                                    <div class="clr-fl">'+p.parseDate(i.createDate)+'</div>\n                                    <div class="clr-fr">\n                                        <div class="clrr-li link">\n                                            <img class="clrr-icon" src="img/icon_reply.png" alt />\n                                            <div class="clrr-text">\u56de\u590d</div>\n                                        </div>\n                                        <div class="clrr-li link">\n                                            <img class="clrr-icon" src="img/praise.png" alt />\n                                            <div class="clrr-text">'+(i.isLike?"\u5df2\u70b9\u8d5e":"\u70b9\u8d5e")+"</div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n"}),n+="                    </div>"),a+='<div class="cli-fun">\n                        <div class="cf-l">'+p.parseDate(i.createDate)+'</div>\n                        <div class="cf-r">\n                            <div class="cf-ri link">\n                                <img class="cfr-icon" src="img/icon_reply.png" alt />\n                                <div class="cfr-text">'+(i.childCommentCount?i.childCommentCount:"\u56de\u590d")+'</div>\n                            </div>\n                            <div class="cf-ri link">\n                                <img class="cfr-icon" src="img/praise.png" alt />\n                                <div class="cfr-text">'+(i.likeCount?i.likeCount:"\u70b9\u8d5e")+"</div>\n                            </div>\n                        </div>\n                    </div>",s+='<div class="cli">\n                <img class="cli-l" src="'+i.avatar+'" alt />\n                <div class="cli-r">\n                    <div class="cli-name">'+i.nickName+'<img class="cli-report link" src="img/icon_alarm.png" alt /></div>\n                    <div class="cli-txt">'+i.content+"</div>\n"+e+n+a+"                </div>\n            </div>"})):s+='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>',p.q(".com-list").innerHTML=s;var n=document.querySelectorAll(".link");if(n&&0<n.length)for(var a=0;a<n.length;a++)n[a].addEventListener("click",function(){openApp()},!1)}})}});var i=document.querySelectorAll(".pan-showall");if(i&&0<i.length)for(var e=0;e<i.length;e++)i[e].addEventListener("click",function(){var i=this.previousElementSibling;i&&i.classList.add("showAll"),this.style.display="none"},!1);v(".show-all").on("click",function(){var i=v(this);i.hasClass("cols")?(i.removeClass("cols").find("span").text("\u6536\u8d77"),i.prev(".vp-list").addClass("showAll")):(i.addClass("cols").find("span").text("\u5c55\u5f00"),i.prev(".vp-list").removeClass("showAll"))});var n=document.querySelectorAll(".link");if(n&&0<n.length)for(var a=0;a<n.length;a++)n[a].addEventListener("click",function(){openApp()},!1);window.onAMapLoaded=function(){var t=new AMap.Map("mapContainer",{zoom:11});(new AMap.Geocoder).getLocation(p.locationProvinceName+p.locationCityName+p.locationTownName,function(i,e){if("complete"===i&&e.geocodes.length){var n=e.geocodes[0].location;t.setCenter([n.lng,n.lat]),p.lng=n.lng,p.lat=n.lat;var a=new AMap.Marker({icon:"../img/pos.png",position:[n.lng,n.lat],anchor:"bottom-center"});t.add(a),AMap.plugin(["AMap.PlaceSearch"],function(){var i=new AMap.PlaceSearch({pageSize:6,pageIndex:1,datatype:"poi",city:p.locationCity,citylimit:!0,autoFitView:!0});i.searchNearBy("\u706b\u8f66\u7ad9",[n.lng,n.lat],1e5,function(i,e){var n=p.q("#railwayStation");if(e&&e.poiList&&e.poiList.pois&&0<e.poiList.pois.length){var a=e.poiList.pois,t="";a.forEach(function(i){t+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),n.innerHTML=t;new s(".s-crh",{slidesPerView:"auto",spaceBetween:30})}else n.parentNode.parentNode.parentNode.style.display="none"}),i.searchNearBy("\u6c7d\u8f66\u7ad9",[n.lng,n.lat],1e5,function(i,e){var n=p.q("#busStation");if(e&&e.poiList&&e.poiList.pois&&0<e.poiList.pois.length){var a=e.poiList.pois,t="";a.forEach(function(i){t+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),n.innerHTML=t;new s(".s-bus",{slidesPerView:"auto",spaceBetween:30})}else n.parentNode.parentNode.parentNode.style.display="none"}),i.searchNearBy("\u9ad8\u901f\u8def\u53e3",[n.lng,n.lat],1e5,function(i,e){var n=p.q("#crossing");if(e&&e.poiList&&e.poiList.pois&&0<e.poiList.pois.length){var a=e.poiList.pois,t="";a.forEach(function(i){t+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),n.innerHTML=t;new s(".s-crossing",{slidesPerView:"auto",spaceBetween:30})}else n.parentNode.parentNode.parentNode.style.display="none"})})}else console.log("\u83b7\u53d6\u7ecf\u7eac\u5ea6\u5931\u8d25")})},require(["amap"])});