require.config({paths:{common:"common.min",swiper:"swiper-bundle.min",jquery:"jquery-3.2.1"}}),define(["common","swiper","jquery"],function(t,i,o){t.init();var a,r={id:t.parseQueryString().id,commentList:[],env:"dev",server:{dev:"//dev.xiangdao.info",pro:"//www.xiangdao.info"}},s=new i(".swiper-houses",{slidesPerView:2.5,spaceBetween:10,init:!1});r.initTab=function(t){var n=document.querySelectorAll(".tab-tit"),e=document.querySelectorAll(".tab-con");n[t].classList.add("sel"),e[t].classList.add("sel")},r.eventBind=function(){o(".tab-tit").on("click",function(){for(var t=o(".tab-con"),n=0;n<t.length;n++)o(this).data("id")===t.eq(n).data("id")?(t.eq(n).addClass("sel"),o(this).addClass("sel").siblings(".tab-tit").removeClass("sel")):t.eq(n).removeClass("sel")}),o(".pan-cols").on("click",function(){o("#content").slideToggle(),o(this).toggleClass("col")}),o(document).off("click").on("click",".cop-more",function(){var n=o(this),e=parseInt(n.data("id")),t=n.data("switch"),i=parseInt(n[0].dataset.page);"off"===t?r.requestReplyList(e,r.getPageSize(i),n,i):((i=r.commentList)&&0<i.length&&i.forEach(function(t){t.commentId===e&&(t=4<(t=t.childCommentCount-t.list.length)?5:t,n.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+t+"\u6761\u56de\u590d"))}),n.data("switch","off"),n.find(".cop-more-btn").removeClass("col"),n[0].dataset.page=1,n.prev(".comment-reply").find(".cop-li-add").remove(),i&&0<i.length&&i.forEach(function(t){t.commentId===e&&(t.totalList=t.list)}))}),o(document).on("click",".full-swiper-slide",function(){a.removeAllSlides(),a.updateSlides(),a.destroy(),o("#fullPageImages").hide()}),o(document).on("click",".comment-img,.cop-con-show-img",function(){var n,t=o(this).data("img").split(","),e=parseInt(o(this).data("index"));t&&0<t.length&&(a=new i("#fullPageImages",{init:!1,initialSlide:e,lazy:{elementClass:"swiper-lazy"}}),n="",t.forEach(function(t){n+='<div class="swiper-slide full-swiper-slide" style="background: url('+t+') no-repeat center / 100%"></div>'}),r.q("#fullPageWrap").innerHTML=n,r.q("#fullPageImages").style.display="block",a.init(),a.update())})},r.q=function(t){return document.querySelector(t)},r.getPageSize=function(t){parseInt(t);return 5},r.parseDate=function(t){t=new Date(t);return t.getFullYear()+"-"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())},r.parseDateForComment=function(t){t=new Date(t);return(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())},r.pcaFilter=function(t){if(t)return-1<["\u7701","\u5e02","\u533a"].indexOf(t.substr(t.length-1,1))?t.substring(0,t.length-1):t;return""},r.requestReplyList=function(l,t,c,d){o.ajax({url:r.server[r.env]+"/xiangdao-api/api/news/new_comment_child_list",method:"POST",dataType:"json",async:!1,headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({commentId:l,pageSize:t,pageNo:d}),success:function(n){if(console.log(n),0===n.status){var t="",e=n.json.result,i=r.commentList;if(e&&0<e.length){e.forEach(function(n){i.forEach(function(t){l===t.commentId&&t.totalList&&0<t.totalList.length&&t.totalList.forEach(function(t){t.commentId===n.commentId&&(n.hide=!0)})})}),t+=r.renderReplyList(e);var a=c.prev(".comment-reply");0<a.length?a.append(t):c.before('<div class="comment-reply">'+t+"</div>");var s=document.querySelectorAll(".link");if(s&&0<s.length)for(var o=0;o<s.length;o++)s[o].addEventListener("click",function(){openApp()},!1)}i.forEach(function(t){t.commentId===l&&(t.totalList=t.totalList.concat(e),t.totalList.length<n.json.totalCount?(t=4<(t=n.json.totalCount-t.totalList.length+t.list.length)?5:t,c.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+t+"\u6761\u56de\u590d"),c.find(".cop-more-btn").removeClass("col"),d++,c[0].dataset.page=d):(c.find(".cop-more-text").text("\u6536\u8d77\u5168\u90e8\u56de\u590d"),c.find(".cop-more-btn").addClass("col"),c.data("switch","on")))})}}})},r.renderReplyList=function(t){var n="";return t.forEach(function(t){t.hide||(n+='<div class="cop-li cop-li-add" data-id="'+t.commentId+'">\n            <img class="cop-l" src="'+t.avatar+'" alt />\n            <div class="cop-c">\n                 <div class="cop-name">'+t.nickName+(1===t.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                 <div class="cop-con">\n'+(t.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+t.parentNickName+"</span>\uff1a":"")+(t.content||""),t.images&&(n+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+t.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),n+='</div>\n                 <div class="cop-fun">\n                      <div class="cop-time">'+r.parseDateForComment(t.createDate)+' \xb7 </div>\n                      <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                      <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                 </div>\n            </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(0<t.likeCount?t.likeCount:"")+"</div></div>       </div>")}),n},r.renderCommentList=function(){var s,t=r.commentList;t&&0<t.length&&(s="",t.forEach(function(t){if(s+='<div class="comment-li" data-id="'+t.commentId+'">\n<div class="comment-li-wrap">                        <img class="comment-l" src="'+t.avatar+'" alt />\n                        <div class="comment-c">\n                            <div class="comment-name">'+t.nickName+'</div>\n                            <div class="comment-con">'+(t.content||"")+"</div>\n",t.images){var n=t.images.split(",");if(n&&0<n.length){for(var e='<div class="comment-imgs">',i=0;i<n.length;i++)e+='<img class="comment-img swiper-lazy" data-index="'+i+'" data-img="'+t.images+'" src="'+n[i]+'" alt />';s+=e+="</div>"}}var a;s+='<div class="comment-fun">\n                <div class="comment-time">'+r.parseDateForComment(t.createDate)+' \xb7 </div>\n                <div class="comment-btn-reply link">\u56de\u590dTA</div>\n                <img class="comment-btn-more link" src="img/icon_more_s.png" alt />\n           </div>',s+='</div>\n           <div class="comment-r link">\n               <img class="comment-like-icon" src="img/icon_like_g.png" alt />\n               <div class="comment-like-num">'+(0<t.likeCount?t.likeCount:"")+"</div>\n           </div>\n       </div>",t.totalList&&0<t.totalList.length&&(a="",a+='<div class="comment-reply">',t.totalList.forEach(function(t){a+='<div class="cop-li" data-id="'+t.commentId+'">\n              <img class="cop-l" src="'+t.avatar+'" alt />\n              <div class="cop-c">\n                   <div class="cop-name">'+t.nickName+(1===t.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                   <div class="cop-con">\n                        '+(t.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+t.parentNickName+"</span>\uff1a":"")+(t.content||"")+"\n",t.images&&(a+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+t.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),a+='                   </div>\n                   <div class="cop-fun">\n                        <div class="cop-time">'+r.parseDateForComment(t.createDate)+' \xb7 </div>\n                        <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                        <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                   </div>\n              </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(0<t.likeCount?t.likeCount:"")+"</div></div>         </div>\n"}),s+=a+="</div>"),0<t.childCommentCount-t.totalList.length&&(s+='<div class="cop-more" data-page="1" data-switch="off" data-id="'+t.commentId+'"><span class="cop-more-text">\u70b9\u51fb\u5c55\u5f00'+(4<t.childCommentCount-t.totalList.length?5:t.childCommentCount-t.totalList.length)+'\u6761\u56de\u590d</span><img class="cop-more-btn" src="img/icon_arrow_g2.png" alt /></div>'),o("#commentList").html(s)}))},r.dataInit=function(){t.request({url:r.server[r.env]+"/xiangdao-api/api/news/visit_details/"+r.id,method:"GET",success:function(t){var n,e,i;console.log(t),0!==t.status||(e=t.json)&&(r.q("#playVideo").src=e.video,r.q("#playVideo").poster=e.cover,r.q("#userAvatar").src=e.userAvatar,r.q("#userNickName").innerText=e.userNickName,r.q("#fansCount").innerText=e.fansCount||0,r.q("#videoCount").innerText=e.videoCount||0,r.q("#title").innerText=e.title,r.q("#location").innerText=r.pcaFilter(e.locationProvinceName)+(e.locationCityName?" \xb7 "+r.pcaFilter(e.locationCityName):""),r.q("#lookNumber").innerText=e.lookNumber,r.q("#likeCount").innerText=0<e.likeCount?e.likeCount:"\u70b9\u8d5e",r.q("#publishDate").innerText=r.parseDate(e.publishDate)+"\u53d1\u5e03",t=e.tagName.split(","),""!==e.tagName&&t&&0<t.length?(n="",t.forEach(function(t){n+='<div class="pan-tag">'+t+"</div>"}),r.q("#tagName").innerHTML=n):r.q("#tagName").style.display="none",e.content?r.q("#content").innerText=e.content:r.q(".pan-cols").style.display="none",e.locationTown&&o.ajax({url:r.server[r.env]+"/xiangdao-api/api/news/visit_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({code:e.locationTown,pageSize:8}),success:function(t){var n,e;console.log(t),0===t.status&&(n=t.json.result)&&0<n.length?(e="",n.forEach(function(t){parseInt(r.id)!==t.visitId&&(e+='<a class="lli" data-id="'+t.visitId+'" href="visit.html?id='+t.visitId+'">\n                                <div class="lli-l">\n                                    <img class="lli-img" src="'+t.cover+'" alt />\n                                    <div class="lli-time">'+t.videoDuration+'</div>\n                                </div>\n                                <div class="lli-r">\n                                    <div class="lli-tit">'+t.title+'</div>\n                                    <div class="lli-stit">'+(t.userNickName||"")+"<span>"+t.lookNumber+"</span>\u6b21\u89c2\u770b</div>\n                                </div>\n                            </a>")}),""===(r.q("#tales").innerHTML=e)&&(r.q("#relationStory").style.display="none")):r.q("#relationStory").style.display="none"}}),(e=e.list)&&0<e.length?(i="",e.forEach(function(t){i+='<a class="swiper-slide" data-id="'+t.houseId+'" href="house_details.html?houseId='+t.houseId+'">\n             <img class="roll-slide-img" src="'+t.infoCover+'" alt />\n             <div class="roll-slide-stit">'+t.profileStr+'</div>\n             <div class="roll-slide-tit">'+t.infoTitle+"</div>\n         </a>"}),r.q("#houseList").innerHTML=i,s.init(),""===i&&(r.q("#relationHouses").style.display="none")):r.q("#relationHouses").style.display="none")}}),o.ajax({url:r.server[r.env]+"/xiangdao-api/api/news/new_comment_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({bizId:r.id,bizType:6}),success:function(t){if(console.log(t),0===t.status){var n=t.json.result;if((r.commentList=n)&&0<n.length){r.q("#commentNum").innerText=t.json.totalCount,n.forEach(function(t){t.totalList=t.list}),r.renderCommentList();var e=document.querySelectorAll(".link");if(e&&0<e.length)for(var i=0;i<e.length;i++)e[i].addEventListener("click",function(){openApp()},!1)}else{n="";n+='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>',r.q("#comment").innerHTML='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>'}}}})};var n=document.querySelectorAll(".pan-showall");if(n&&0<n.length)for(var e=0;e<n.length;e++)n[e].addEventListener("click",function(){var t=this.previousElementSibling;t&&t.classList.add("showAll"),this.style.display="none"},!1);o(".show-all").on("click",function(){var t=o(this);t.hasClass("cols")?(t.removeClass("cols").find("span").text("\u6536\u8d77"),t.prev(".vp-list").addClass("showAll")):(t.addClass("cols").find("span").text("\u5c55\u5f00"),t.prev(".vp-list").removeClass("showAll"))});var l=document.querySelectorAll(".link");if(l&&0<l.length)for(var c=0;c<l.length;c++)l[c].addEventListener("click",function(){openApp()},!1);r.init=function(){r.initTab(0),r.eventBind(),r.dataInit()},r.init()});