require.config({paths:{common:"common.min",swiper:"swiper.min",jquery:"jquery-3.2.1"}}),define(["common","swiper","jquery"],function(r,s,d){r.init();var v={s:["","\u680b","\u95f4","\u5957","\u4eba"],env:"dev",server:{dev:"//dev.xiangdao.info",pro:"//www.xiangdao.info"},parseDate:function(i){i=new Date(i);return(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1)+"-"+(i.getDate()<10?"0"+i.getDate():i.getDate())+" "+(i.getHours()<10?"0"+i.getHours():i.getHours())+":"+(i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes())},swapArray:function(i,e,n){return i[e]=i.splice(n,1,i[e])[0],i},q:function(i){return document.querySelector(i)},init:function(){v.id=r.parseQueryString().id;var o=new s(".swiper-album",{slidesPerView:2.5,spaceBetween:20,init:!1});r.request({url:v.server[v.env]+"/xiangdao-api/api/news/village_details/"+v.id,method:"GET",success:function(i){console.log(i);var c=i.json;v.locationCity=c.locationCity,v.locationDetail=c.locationDetail,v.locationProvinceName=c.locationProvinceName,v.locationCityName=c.locationCityName,v.locationTownName=c.locationTownName;var e,n=v.q("#playVideo"),t=v.q("#imgList"),s=v.q(".contentTitle"),a=v.q(".contentSTitle"),l=v.q(".contentContent"),i=v.q("#likeCount");n.src=c.video,n.poster=c.videoGif,!c.briefImages||(n=c.briefImages.split(","))&&0<n.length&&(e="",n.forEach(function(i){e+='<div class="swiper-slide album-li" style="background-image: url('+i+')"></div>'}),t.innerHTML=e,o.init()),s.innerText=c.villageName,a.innerText=c.lookNumber?c.lookNumber+"\u4eba\u89c2\u770b":"",i.innerText=c.likeCount,l.innerHTML=c.content,c.villageId&&d.ajax({url:v.server[v.env]+"/xiangdao-api/api/house/house_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({villageId:c.villageId,pageSize:20}),success:function(i){var e;console.log(i),0===i.status&&((i=i.json.result)&&0<i.length?(e="",i.forEach(function(i){e+='<div class="vp-li" data-id="'+i.houseId+'">\n                <img class="vp-l" src="'+i.infoCover+'" alt />\n                <div class="vp-r">\n                    <div class="vp-st">'+i.profileStr+'</div>\n                    <div class="vp-ti">'+i.infoTitle+'</div>\n                    <div class="vp-price"><span>\uffe5<i>'+i.ruleMonthMoney+"</i></span>"+(i.profileRentMode?"/"+v.s[i.profileRentMode]:"")+"/\u6708</div>\n                </div>\n            </div>"}),v.q(".vp-list").innerHTML=e,1===i.length?(v.q(".vp-list").style.height="2.32rem",v.q(".show-all").style.display="none"):(2===i.length&&(v.q(".show-all").style.display="none"),v.q(".vp-list").style.height="5.6rem"),d(".vp-li").on("click",function(){var i=d(this).data("id");location.href="house_details.html?houseId="+i})):v.q(".vp-wrap").style.display="none")}}),c.villageIcon?r.request({url:v.server[v.env]+"/xiangdao-api/api/houseEditor/get_village_icon_group",success:function(i){if(console.log(i),(i=i.json)&&0<i.length){var e="",s=c.villageIcon.split(",");(i=v.swapArray(i,0,1)).forEach(function(t){e+='<div class="ist" data-id="'+t.type+'">\n                <div class="ist-l">\n                    <img class="ist-icon" src="'+t.typeUrl+'" alt/>\n                    <div class="ist-text">'+t.typeName+'</div>\n                </div>\n                <div class="ist-r">\n';var i="";t.list.forEach(function(e){var n=!1;s&&0<s.length&&s.forEach(function(i){i=i.split("-");i[0]==t.type&&i[1]==e.iconSeq&&(n=!0)}),n&&(i+='<div class="ist-li '+(n?"sel":"")+'" data-id="'+e.iconSeq+'">'+e.iconName+"</div>")}),e+=i,e+="</div></div>"});i=v.q("#insWrap");i.innerHTML=e;var n=document.querySelectorAll(".ist"),t=[];if(n&&0<n.length){for(var a=0;a<n.length;a++)0===d(n[a]).find(".ist-li").length&&t.push(d(".ist").eq(a));0<t.length&&t.forEach(function(i){i.remove()});var l=0,o=i.querySelectorAll(".ist");o.length<4&&d("#insMore").hide(),[2,3,5].forEach(function(e){o.forEach(function(i){e===parseInt(i.dataset.id)&&(l+=i.clientHeight)})}),i.style.height=l+"px",console.log(l)}else d("#insMore").parents(".pan").hide()}}}):d("#insMore").parents(".pan").hide(),d.ajax({url:v.server[v.env]+"/xiangdao-api/api/news/comment_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({bizId:parseInt(v.id),bizType:1,pageNo:1}),success:function(i){console.log(i);var e=i.json.result,a="";e&&0<e.length?(v.q("#totalCount").innerText=" \xb7 "+i.json.totalCount,e.forEach(function(i){var e,n="",t="",s="";i.images&&(n+='<div class="cli-imgs">\n',(e=i.images.split(","))&&0<e.length&&e.forEach(function(i){n+='<img class="cli-img" src="'+i+'" alt />'}),n+="</div>\n"),i.list&&0<i.list.length&&(t+='<div class="cli-reply">\n',i.list.forEach(function(i){t+='                        <div class="clr-li">\n                            <img class="clr-l" src="'+i.avatar+'" alt />\n                            <div class="clr-r">\n                                <div class="clr-name">'+i.nickName+'</div>\n                                <div class="clr-cont">'+(i.parentNickName?"\u56de\u590d"+i.parentNickName+": ":"")+i.content+'</div>\n                                <div class="clr-fun">\n                                    <div class="clr-fl">'+v.parseDate(i.createDate)+'</div>\n                                    <div class="clr-fr">\n                                        <div class="clrr-li link">\n                                            <img class="clrr-icon" src="img/icon_reply.png" alt />\n                                            <div class="clrr-text">\u56de\u590d</div>\n                                        </div>\n                                        <div class="clrr-li link">\n                                            <img class="clrr-icon" src="img/praise.png" alt />\n                                            <div class="clrr-text">'+(i.isLike?"\u5df2\u70b9\u8d5e":"\u70b9\u8d5e")+"</div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n"}),t+="                    </div>"),s+='<div class="cli-fun">\n                        <div class="cf-l">'+v.parseDate(i.createDate)+'</div>\n                        <div class="cf-r">\n                            <div class="cf-ri link">\n                                <img class="cfr-icon" src="img/icon_reply.png" alt />\n                                <div class="cfr-text">'+(i.childCommentCount||"\u56de\u590d")+'</div>\n                            </div>\n                            <div class="cf-ri link">\n                                <img class="cfr-icon" src="img/praise.png" alt />\n                                <div class="cfr-text">'+(i.likeCount||"\u70b9\u8d5e")+"</div>\n                            </div>\n                        </div>\n                    </div>",a+='<div class="cli">\n                <img class="cli-l" src="'+i.avatar+'" alt />\n                <div class="cli-r">\n                    <div class="cli-name">'+i.nickName+'<img class="cli-report link" src="img/icon_alarm.png" alt /></div>\n                    <div class="cli-txt">'+i.content+"</div>\n"+n+t+s+"                </div>\n            </div>"})):a+='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>',v.q(".com-list").innerHTML=a;var n=document.querySelectorAll(".link");if(n&&0<n.length)for(var t=0;t<n.length;t++)n[t].addEventListener("click",function(){openApp()},!1)}})}});var i=document.querySelectorAll(".pan-showall");if(i&&0<i.length)for(var e=0;e<i.length;e++)i[e].addEventListener("click",function(){var i=this.previousElementSibling;i&&i.classList.add("showAll"),this.style.display="none"},!1);d(".show-all").on("click",function(){var i=d(this);i.hasClass("cols")?(i.removeClass("cols").find("span").text("\u6536\u8d77"),i.prev(".vp-list").addClass("showAll")):(i.addClass("cols").find("span").text("\u5c55\u5f00"),i.prev(".vp-list").removeClass("showAll"))});var n=document.querySelectorAll(".link");if(n&&0<n.length)for(var t=0;t<n.length;t++)n[t].addEventListener("click",function(){openApp()},!1);v.onAMapLoaded()},onAMapLoaded:function(){var t=new AMap.Map("mapContainer",{zoom:11});AMap.plugin("AMap.Geocoder",function(){(new AMap.Geocoder).getLocation(v.locationProvinceName+v.locationCityName+v.locationTownName,function(i,e){var n;"complete"===i&&e.geocodes.length?(n=e.geocodes[0].location,t.setCenter([n.lng,n.lat]),v.lng=n.lng,v.lat=n.lat,e=new AMap.Marker({icon:"/h5/img/pos.png",position:[n.lng,n.lat],anchor:"bottom-center"}),t.add(e),AMap.plugin(["AMap.PlaceSearch"],function(){var i=new AMap.PlaceSearch({pageSize:6,pageIndex:1,datatype:"poi",city:v.locationCity,citylimit:!0,autoFitView:!0});i.searchNearBy("\u706b\u8f66\u7ad9",[n.lng,n.lat],1e5,function(i,e){var n,t=v.q("#railwayStation");e&&e.poiList&&e.poiList.pois&&0<e.poiList.pois.length?(e=e.poiList.pois,n="",e.forEach(function(i){n+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),t.innerHTML=n,new s(".s-crh",{slidesPerView:"auto",spaceBetween:30})):t.parentNode.parentNode.parentNode.style.display="none"}),i.searchNearBy("\u6c7d\u8f66\u7ad9",[n.lng,n.lat],1e5,function(i,e){var n,t=v.q("#busStation");e&&e.poiList&&e.poiList.pois&&0<e.poiList.pois.length?(e=e.poiList.pois,n="",e.forEach(function(i){n+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),t.innerHTML=n,new s(".s-bus",{slidesPerView:"auto",spaceBetween:30})):t.parentNode.parentNode.parentNode.style.display="none"}),i.searchNearBy("\u9ad8\u901f\u8def\u53e3",[n.lng,n.lat],1e5,function(i,e){var n,t=v.q("#crossing");e&&e.poiList&&e.poiList.pois&&0<e.poiList.pois.length?(e=e.poiList.pois,n="",e.forEach(function(i){n+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+i.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+i.distance/1e3+"\u516c\u91cc</div>\n</div>"}),t.innerHTML=n,new s(".s-crossing",{slidesPerView:"auto",spaceBetween:30})):t.parentNode.parentNode.parentNode.style.display="none"})})):console.log("\u83b7\u53d6\u7ecf\u7eac\u5ea6\u5931\u8d25")})})}};v.init()});