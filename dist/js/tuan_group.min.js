require.config({paths:{common:"common.min",swiper:"swiper-bundle.min",jquery:"jquery-3.2.1"}}),define(["common","swiper","jquery"],function(m,a,v){m.init();var g={id:m.parseQueryString().id,commentList:[],env:"dev",server:{dev:"//dev.xiangdao.info",pro:"//www.xiangdao.info"},swapArray:function(e,i,t){return e[i]=e.splice(t,1,e[i])[0],e},eventBind:function(){v(document).off("click").on("click",".cop-more",function(){var i=v(this),t=parseInt(i.data("id")),e=i.data("switch"),n=parseInt(i[0].dataset.page);"off"===e?g.requestReplyList(t,g.getPageSize(n),i,n):((n=g.commentList)&&0<n.length&&n.forEach(function(e){e.commentId===t&&(e=4<(e=e.childCommentCount-e.list.length)?5:e,i.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+e+"\u6761\u56de\u590d"))}),i.data("switch","off"),i.find(".cop-more-btn").removeClass("col"),i[0].dataset.page=1,i.prev(".comment-reply").find(".cop-li-add").remove(),n&&0<n.length&&n.forEach(function(e){e.commentId===t&&(e.totalList=e.list)}))}),v(document).on("click",".full-swiper-slide",function(){swiper2.removeAllSlides(),swiper2.updateSlides(),swiper2.destroy(),v("#fullPageImages").hide()}),v(document).on("click",".comment-img,.cop-con-show-img",function(){var i,e=v(this).data("img").split(","),t=parseInt(v(this).data("index"));e&&0<e.length&&(swiper2=new a("#fullPageImages",{init:!1,initialSlide:t,lazy:{elementClass:"swiper-lazy"}}),i="",e.forEach(function(e){i+='<div class="swiper-slide full-swiper-slide" style="background: url('+e+') no-repeat center / 100%"></div>'}),g.q("#fullPageWrap").innerHTML=i,g.q("#fullPageImages").style.display="block",swiper2.init(),swiper2.update())}),v(".top-tags-r").on("click",function(){v(".pe").css("display","flex")}),v(".pe-close").on("click",function(){v(".pe").css("display","none")})},q:function(e){return document.querySelector(e)},getPageSize:function(e){parseInt(e);return 5},parseDate:function(e){e=new Date(e);return e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())},parseDateForComment:function(e){e=new Date(e);return(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())},parseDateToStr:function(e){e=new Date(e);return e.getFullYear()+"\u5e74"+(e.getMonth()+1)+"\u6708"+e.getDate()+"\u65e5"},init:function(){g.eventBind(),g.initSwiper(),g.initPageData(),g.onAMapLoaded()},initPageData:function(){v.ajax({url:g.server[g.env]+"/xiangdao-api/api/tuan/group_details",method:"POST",dataType:"json",async:!1,headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({groupId:g.id}),success:function(e){var r,i,t,n,a,s,o,c,l,d,p;console.log(e),0===e.status&&(r=e.json,g.locationCity=r.locationCity,g.locationDetail=r.locationDetail,g.locationProvinceName=r.locationProvinceName,g.locationCityName=r.locationCityName,g.locationTownName=r.locationTownName,c=g.q(".top-tit"),i=g.q(".top-tags-l"),t=g.q(".pe-list"),n=g.q(".top-sif-l"),a=g.q(".top-srf-r"),e=g.q("#headImgs"),s=g.q("#houseDesc"),o="",r.video&&(o+='<div class="swiper-slide"><video id="video" class="head-video-li" preload="auto" controls  webkit-playsinline="true"\n playsinline="true"\n x5-playsinline="true"\n x5-video-player-type="h5"\n x5-video-player-fullscreen=""\n x5-video-orientation="portraint"\n x-webkit-airplay="true"\n controlsList="nodownload" controls="controls" src="'+r.video+'" poster="'+r.videoGif+'" /></div>'),r.briefImages&&r.briefImages.split(",").forEach(function(e){o+='<div class="swiper-slide"><img class="head-img-li" src="'+e+'" alt/></div>'}),e.innerHTML=o,g.swiper2.update(),c.innerText=r.villageName,r.tagName&&(c=r.tagName.split(","),d=l="",c.forEach(function(e,i){i<4?l+='<div class="top-tag">'+e+"</div>":g.q(".top-tags-r").style.display="block",d+='<div class="top-tag-pop">'+e+"</div>"}),i.innerHTML=l,t.innerHTML=d),r.brief&&n&&(n.innerText=r.brief),r.liveBeginTime&&r.liveEndTime&&a&&(a.innerText=g.parseDateToStr(r.liveBeginTime)+"-"+g.parseDateToStr(r.liveEndTime)),s&&r.content&&(s.innerHTML=r.content,setTimeout(function(){var e=g.q(".desc-more"),i=g.q(".desc-con");e&&(8<s.clientHeight/rem?(e.classList.add("show"),i.classList.remove("showAll")):(e.classList.remove("show"),i.classList.add("showAll"),e.style.display="none"))},1e3)),r.list&&0<r.list.length&&(p="",r.list.forEach(function(e){var t;p+='<a class="group-li '+(2===e.status||1===e.isBookUp?"gl-out":"")+'" data-id="'+e.tuanId+'" href="tuan.html?id='+e.tuanId+'">                <img class="gli-l" src="'+e.infoCover+'" alt/>                <div class="gli-r">                    <div class="gli-tit">'+e.infoTitle+'</div>                    <div class="gli-tags">',e.tagName&&(t="",e.tagName.split(",").forEach(function(e,i){i<3&&(t+='<div class="gli-tag">'+e+"</div>")}),p+=t),p+='</div>\n<div class="gli-price">\u9884\u8ba2\u4ef7\uff1a<i>\uffe5</i><span>'+(e.tuanPrice?g.accMul(e.tuanPrice,30):0)+'</span></div><div class="gli-inf">'+(-1<e.reserveTypeStr.indexOf("1")?"\u4eba/\u6708/\u5e8a\u4f4d/\u5305\u4e09\u9910":"\u6708/\u6574\u95f4\u623f/\u5305\u4e09\u9910")+"</div>",0<e.isBookUp?p+='<div class="gli-od gli-out"></div>':p+='<div class="gli-od gli-in">\u8be6\u60c5</div>',p+="</div></div>"}),g.q(".group-con").innerHTML=p),r.villageIcon?m.request({url:g.server[g.env]+"/xiangdao-api/api/houseEditor/get_village_icon_group",success:function(e){if(console.log(e),(e=e.json)&&0<e.length){var i="",a=r.villageIcon.split(",");(e=g.swapArray(e,0,1)).forEach(function(n){i+='<div class="ist" data-id="'+n.type+'">\n                <div class="ist-l">\n                    <img class="ist-icon" src="'+n.typeUrl+'" alt/>\n                    <div class="ist-text">'+n.typeName+'</div>\n                </div>\n                <div class="ist-r">\n';var e="";n.list.forEach(function(i){var t=!1;a&&0<a.length&&a.forEach(function(e){e=e.split("-");e[0]==n.type&&e[1]==i.iconSeq&&(t=!0)}),t&&(e+='<div class="ist-li '+(t?"sel":"")+'" data-id="'+i.iconSeq+'">'+i.iconName+"</div>")}),i+=e,i+="</div></div>"});e=g.q("#insWrap");e.innerHTML=i;var t=document.querySelectorAll(".ist"),n=[];if(t&&0<t.length){for(var s=0;s<t.length;s++){var o=v(t[s]).find(".ist-li").length;0===o?n.push(v(".ist").eq(s)):o<3&&v(t[s]).addClass("align-center")}0<n.length&&n.forEach(function(e){e.remove()});var c=0,l=e.querySelectorAll(".ist");l.length<4&&v("#insMore").hide(),[2,3,5].forEach(function(i){l.forEach(function(e){i===parseInt(e.dataset.id)&&(c+=e.clientHeight)})}),e.style.height=c+"px"}else v("#insMore").parents(".pan").hide()}}}):v("#insMore").parents(".m-ist").hide(),r.mustSee?g.q("#mustSee").innerHTML=r.mustSee:g.q("#mustSee").parentNode.style.display="none",r.hotelPolicy?g.q("#hotelPolicy").innerHTML=r.hotelPolicy:g.q("#hotelPolicy").parentNode.style.display="none",v.ajax({url:g.server[g.env]+"/xiangdao-api/api/news/new_comment_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({bizId:r.villageId,bizType:1}),success:function(e){if(console.log(e),0===e.status){e=e.json.result;if((g.commentList=e)&&0<e.length){e.forEach(function(e){e.totalList=e.list}),g.renderCommentList();var i=document.querySelectorAll(".link");if(i&&0<i.length)for(var t=0;t<i.length;t++)i[t].addEventListener("click",function(){openApp()},!1)}else{e="";e+='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>',g.q("#comment").innerHTML='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>'}}}}))}})},initSwiper:function(){g.q("#pag");g.swiper2=new a(".top-swiper-container",{pagination:{el:".top-swiper-pagination",type:"fraction"},on:{transitionEnd:function(){var e=document.querySelectorAll("video");if(e&&0<e.length)for(var i=0;i<e.length;i++)e[i].pause()}}})},formatTime:function(e){var i=parseInt(e/86400),t=parseInt(e%86400/3600),n=parseInt(e%3600/60),e=parseInt(e%60);return(0<i?"<i>"+i+"</i>\u5929":"")+"<i>"+(t=t<10?"0"+t:t)+"</i>:<i>"+(n=n<10?"0"+n:n)+"</i>:<i>"+(e=e<10?"0"+e:e)+"</i>"},accMul:function(e,i){var t=0,e=e.toString(),i=i.toString();try{t+=e.split(".")[1].length}catch(e){}try{t+=i.split(".")[1].length}catch(e){}return Number(e.replace(".",""))*Number(i.replace(".",""))/Math.pow(10,t)},requestReplyList:function(c,e,l,r){v.ajax({url:g.server[g.env]+"/xiangdao-api/api/news/new_comment_child_list",method:"POST",dataType:"json",async:!1,headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({commentId:c,pageSize:e,pageNo:r}),success:function(i){if(console.log(i),0===i.status){var e="",t=i.json.result,n=g.commentList;if(t&&0<t.length){t.forEach(function(i){n.forEach(function(e){c===e.commentId&&e.totalList&&0<e.totalList.length&&e.totalList.forEach(function(e){e.commentId===i.commentId&&(i.hide=!0)})})}),e+=g.renderReplyList(t);var a=l.prev(".comment-reply");0<a.length?a.append(e):l.before('<div class="comment-reply">'+e+"</div>");var s=document.querySelectorAll(".link");if(s&&0<s.length)for(var o=0;o<s.length;o++)s[o].addEventListener("click",function(){openApp()},!1)}n.forEach(function(e){e.commentId===c&&(e.totalList=e.totalList.concat(t),e.totalList.length<i.json.totalCount?(e=4<(e=i.json.totalCount-e.totalList.length+e.list.length)?5:e,l.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+e+"\u6761\u56de\u590d"),l.find(".cop-more-btn").removeClass("col"),r++,l[0].dataset.page=r):(l.find(".cop-more-text").text("\u6536\u8d77\u5168\u90e8\u56de\u590d"),l.find(".cop-more-btn").addClass("col"),l.data("switch","on")))})}}})},renderReplyList:function(e){var i="";return e.forEach(function(e){e.hide||(i+='<div class="cop-li cop-li-add" data-id="'+e.commentId+'">\n            <img class="cop-l" src="'+e.avatar+'" alt />\n            <div class="cop-c">\n                 <div class="cop-name">'+e.nickName+(1===e.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                 <div class="cop-con">\n'+(e.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+e.parentNickName+"</span>\uff1a":"")+(e.content||""),e.images&&(i+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+e.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),i+='</div>\n                 <div class="cop-fun">\n                      <div class="cop-time">'+g.parseDateForComment(e.createDate)+' \xb7 </div>\n                      <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                      <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                 </div>\n            </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(0<e.likeCount?e.likeCount:"")+"</div></div>       </div>")}),i},renderCommentList:function(){var s,e=g.commentList;e&&0<e.length&&(s="",e.forEach(function(e){if(s+='<div class="comment-li" data-id="'+e.commentId+'">\n<div class="comment-li-wrap">                        <img class="comment-l" src="'+e.avatar+'" alt />\n                        <div class="comment-c">\n                            <div class="comment-name">'+e.nickName+'</div>\n                            <div class="comment-con">'+(e.content||"")+"</div>\n",e.images){var i=e.images.split(",");if(i&&0<i.length){for(var t='<div class="comment-imgs">',n=0;n<i.length;n++)t+='<img class="comment-img swiper-lazy" data-index="'+n+'" data-img="'+e.images+'" src="'+i[n]+'" alt />';s+=t+="</div>"}}var a;s+='<div class="comment-fun">\n                <div class="comment-time">'+g.parseDateForComment(e.createDate)+' \xb7 </div>\n                <div class="comment-btn-reply link">\u56de\u590dTA</div>\n                <img class="comment-btn-more link" src="img/icon_more_s.png" alt />\n           </div>',s+='</div>\n           <div class="comment-r link">\n               <img class="comment-like-icon" src="img/icon_like_g.png" alt />\n               <div class="comment-like-num">'+(0<e.likeCount?e.likeCount:"")+"</div>\n           </div>\n       </div>",e.totalList&&0<e.totalList.length&&(a="",a+='<div class="comment-reply">',e.totalList.forEach(function(e){a+='<div class="cop-li" data-id="'+e.commentId+'">\n              <img class="cop-l" src="'+e.avatar+'" alt />\n              <div class="cop-c">\n                   <div class="cop-name">'+e.nickName+(1===e.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                   <div class="cop-con">\n                        '+(e.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+e.parentNickName+"</span>\uff1a":"")+(e.content||"")+"\n",e.images&&(a+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+e.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),a+='                   </div>\n                   <div class="cop-fun">\n                        <div class="cop-time">'+g.parseDateForComment(e.createDate)+' \xb7 </div>\n                        <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                        <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                   </div>\n              </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(0<e.likeCount?e.likeCount:"")+"</div></div>         </div>\n"}),s+=a+="</div>"),0<e.childCommentCount-e.totalList.length&&(s+='<div class="cop-more" data-page="1" data-switch="off" data-id="'+e.commentId+'"><span class="cop-more-text">\u70b9\u51fb\u5c55\u5f00'+(4<e.childCommentCount-e.totalList.length?5:e.childCommentCount-e.totalList.length)+'\u6761\u56de\u590d</span><img class="cop-more-btn" src="img/icon_arrow_g2.png" alt /></div>'),v("#commentList").html(s)}))}},e=document.querySelectorAll(".pan-showall");if(e&&0<e.length)for(var i=0;i<e.length;i++)e[i].addEventListener("click",function(){var e=this.previousElementSibling;e&&e.classList.add("showAll"),this.style.display="none"},!1);v(".show-all").on("click",function(){var e=v(this);e.hasClass("cols")?(e.removeClass("cols").find("span").text("\u6536\u8d77"),e.prev(".vp-list").addClass("showAll")):(e.addClass("cols").find("span").text("\u5c55\u5f00"),e.prev(".vp-list").removeClass("showAll"))});var t=document.querySelectorAll(".link");if(t&&0<t.length)for(var n=0;n<t.length;n++)t[n].addEventListener("click",function(){openApp()},!1);var s=document.querySelector(".desc-more");s&&s.addEventListener("click",function(){"1"===this.dataset.stat?(this.querySelector(".desc-more-img").classList.remove("up"),g.q("#houseDesc").classList.remove("showAll"),this.querySelector(".desc-more-txt").innerText="\u67e5\u770b\u5168\u90e8",this.classList.add("show"),this.dataset.stat="2",window.scrollTo({top:g.q(".m-desc").offsetTop})):(g.q("#houseDesc").classList.add("showAll"),this.querySelector(".desc-more-img").classList.add("up"),this.querySelector(".desc-more-txt").innerText="\u6536\u8d77",this.classList.remove("show"),this.dataset.stat="1")},!1),g.onAMapLoaded=function(){var n=new AMap.Map("mapContainer",{zoom:11});AMap.plugin("AMap.Geocoder",function(){(new AMap.Geocoder).getLocation(g.locationProvinceName+g.locationCityName+g.locationTownName,function(e,i){var t;"complete"===e&&i.geocodes.length?(t=i.geocodes[0].location,n.setCenter([t.lng,t.lat]),g.lng=t.lng,g.lat=t.lat,i=new AMap.Marker({icon:"/h5/img/pos.png",position:[t.lng,t.lat],anchor:"bottom-center"}),n.add(i),AMap.plugin(["AMap.PlaceSearch"],function(){var e=new AMap.PlaceSearch({pageSize:6,pageIndex:1,datatype:"poi",city:g.locationCity,citylimit:!0,autoFitView:!0});e.searchNearBy("\u706b\u8f66\u7ad9",[t.lng,t.lat],1e5,function(e,i){var t,n=g.q("#railwayStation");i&&i.poiList&&i.poiList.pois&&0<i.poiList.pois.length?(i=i.poiList.pois,t="",i.forEach(function(e){t+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+e.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+e.distance/1e3+"\u516c\u91cc</div>\n</div>"}),n.innerHTML=t,new a(".s-crh",{slidesPerView:"auto",spaceBetween:30})):n.parentNode.parentNode.parentNode.style.display="none"}),e.searchNearBy("\u6c7d\u8f66\u7ad9",[t.lng,t.lat],1e5,function(e,i){var t,n=g.q("#busStation");i&&i.poiList&&i.poiList.pois&&0<i.poiList.pois.length?(i=i.poiList.pois,t="",i.forEach(function(e){t+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+e.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+e.distance/1e3+"\u516c\u91cc</div>\n</div>"}),n.innerHTML=t,new a(".s-bus",{slidesPerView:"auto",spaceBetween:30})):n.parentNode.parentNode.parentNode.style.display="none"}),e.searchNearBy("\u9ad8\u901f\u8def\u53e3",[t.lng,t.lat],1e5,function(e,i){var t,n=g.q("#crossing");i&&i.poiList&&i.poiList.pois&&0<i.poiList.pois.length?(i=i.poiList.pois,t="",i.forEach(function(e){t+='<div class="swiper-slide mrr-li">\n     <div class="mrr-tit">'+e.name+'</div>\n     <div class="mrr-des">\u623f\u6e90\u8ddd\u79bb'+e.distance/1e3+"\u516c\u91cc</div>\n</div>"}),n.innerHTML=t,new a(".s-crossing",{slidesPerView:"auto",spaceBetween:30})):n.parentNode.parentNode.parentNode.style.display="none"})})):console.log("\u83b7\u53d6\u7ecf\u7eac\u5ea6\u5931\u8d25")})})},g.init()});