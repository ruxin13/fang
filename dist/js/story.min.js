require.config({paths:{common:"common.min",swiper:"swiper-bundle.min",jquery:"jquery-3.2.1"}}),define(["common","swiper","jquery"],function(t,i,o){t.init();var a,d={id:t.parseQueryString().id,commentList:[],colorList:[{c:"#E17166",b:"#FDD9D5"},{c:"#F3BA5B",b:"#FDF4E7"},{c:"#5394F1",b:"#EDF4FB"}],env:"dev",server:{dev:"//dev.xiangdao.info",pro:"//www.xiangdao.info"}},s=new i(".swiper-houses",{slidesPerView:2.5,spaceBetween:10,init:!1});d.initTab=function(t){var e=document.querySelectorAll(".tab-tit"),n=document.querySelectorAll(".tab-con");e[t].classList.add("sel"),n[t].classList.add("sel")},d.eventBind=function(){o(".tab-tit").on("click",function(){for(var t=o(".tab-con"),e=0;e<t.length;e++)o(this).data("id")===t.eq(e).data("id")?(t.eq(e).addClass("sel"),o(this).addClass("sel").siblings(".tab-tit").removeClass("sel")):t.eq(e).removeClass("sel")}),o(".pan-cols").on("click",function(){o("#content").slideToggle(),o(this).toggleClass("col")}),o(document).off("click").on("click",".cop-more",function(){var e=o(this),n=parseInt(e.data("id")),t=e.data("switch"),i=parseInt(e[0].dataset.page);"off"===t?d.requestReplyList(n,d.getPageSize(i),e,i):((i=d.commentList)&&0<i.length&&i.forEach(function(t){t.commentId===n&&(t=4<(t=t.childCommentCount-t.list.length)?5:t,e.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+t+"\u6761\u56de\u590d"))}),e.data("switch","off"),e.find(".cop-more-btn").removeClass("col"),e[0].dataset.page=1,e.prev(".comment-reply").find(".cop-li-add").remove(),i&&0<i.length&&i.forEach(function(t){t.commentId===n&&(t.totalList=t.list)}))}),o(document).on("click",".full-swiper-slide",function(){a.removeAllSlides(),a.updateSlides(),a.destroy(),o("#fullPageImages").hide()}),o(document).on("click",".comment-img,.cop-con-show-img",function(){var e,t=o(this).data("img").split(","),n=parseInt(o(this).data("index"));t&&0<t.length&&(a=new i("#fullPageImages",{init:!1,initialSlide:n,lazy:{elementClass:"swiper-lazy"}}),e="",t.forEach(function(t){e+='<div class="swiper-slide full-swiper-slide" style="background: url('+t+') no-repeat center / 100%"></div>'}),d.q("#fullPageWrap").innerHTML=e,d.q("#fullPageImages").style.display="block",a.init(),a.update())})},d.q=function(t){return document.querySelector(t)},d.getPageSize=function(t){parseInt(t);return 5},d.parseDate=function(t){t=new Date(t);return t.getFullYear()+"-"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())},d.parseDateForComment=function(t){t=new Date(t);return(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())},d.pcaFilter=function(t){if(t)return-1<["\u7701","\u5e02","\u533a"].indexOf(t.substr(t.length-1,1))?t.substring(0,t.length-1):t;return""},d.requestReplyList=function(l,t,c,r){o.ajax({url:d.server[d.env]+"/xiangdao-api/api/news/new_comment_child_list",method:"POST",dataType:"json",async:!1,headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({commentId:l,pageSize:t,pageNo:r}),success:function(e){if(console.log(e),0===e.status){var t="",n=e.json.result,i=d.commentList;if(n&&0<n.length){n.forEach(function(e){i.forEach(function(t){l===t.commentId&&t.totalList&&0<t.totalList.length&&t.totalList.forEach(function(t){t.commentId===e.commentId&&(e.hide=!0)})})}),t+=d.renderReplyList(n);var a=c.prev(".comment-reply");0<a.length?a.append(t):c.before('<div class="comment-reply">'+t+"</div>");var s=document.querySelectorAll(".link");if(s&&0<s.length)for(var o=0;o<s.length;o++)s[o].addEventListener("click",function(){openApp()},!1)}i.forEach(function(t){t.commentId===l&&(t.totalList=t.totalList.concat(n),t.totalList.length<e.json.totalCount?(t=4<(t=e.json.totalCount-t.totalList.length+t.list.length)?5:t,c.find(".cop-more-text").text("\u70b9\u51fb\u5c55\u5f00"+t+"\u6761\u56de\u590d"),c.find(".cop-more-btn").removeClass("col"),r++,c[0].dataset.page=r):(c.find(".cop-more-text").text("\u6536\u8d77\u5168\u90e8\u56de\u590d"),c.find(".cop-more-btn").addClass("col"),c.data("switch","on")))})}}})},d.renderReplyList=function(t){var e="";return t.forEach(function(t){t.hide||(e+='<div class="cop-li cop-li-add" data-id="'+t.commentId+'">\n            <img class="cop-l" src="'+t.avatar+'" alt />\n            <div class="cop-c">\n                 <div class="cop-name">'+t.nickName+(1===t.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                 <div class="cop-con">\n'+(t.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+t.parentNickName+"</span>\uff1a":"")+(t.content||""),t.images&&(e+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+t.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),e+='</div>\n                 <div class="cop-fun">\n                      <div class="cop-time">'+d.parseDateForComment(t.createDate)+' \xb7 </div>\n                      <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                      <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                 </div>\n            </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(0<t.likeCount?t.likeCount:"")+"</div></div>       </div>")}),e},d.renderCommentList=function(){var s,t=d.commentList;t&&0<t.length&&(s="",t.forEach(function(t){if(s+='<div class="comment-li" data-id="'+t.commentId+'">\n<div class="comment-li-wrap">                        <img class="comment-l" src="'+t.avatar+'" alt />\n                        <div class="comment-c">\n                            <div class="comment-name">'+t.nickName+'</div>\n                            <div class="comment-con">'+(t.content||"")+"</div>\n",t.images){var e=t.images.split(",");if(e&&0<e.length){for(var n='<div class="comment-imgs">',i=0;i<e.length;i++)n+='<img class="comment-img swiper-lazy" data-index="'+i+'" data-img="'+t.images+'" src="'+e[i]+'" alt />';s+=n+="</div>"}}var a;s+='<div class="comment-fun">\n                <div class="comment-time">'+d.parseDateForComment(t.createDate)+' \xb7 </div>\n                <div class="comment-btn-reply link">\u56de\u590dTA</div>\n                <img class="comment-btn-more link" src="img/icon_more_s.png" alt />\n           </div>',s+='</div>\n           <div class="comment-r link">\n               <img class="comment-like-icon" src="img/icon_like_g.png" alt />\n               <div class="comment-like-num">'+(0<t.likeCount?t.likeCount:"")+"</div>\n           </div>\n       </div>",t.totalList&&0<t.totalList.length&&(a="",a+='<div class="comment-reply">',t.totalList.forEach(function(t){a+='<div class="cop-li" data-id="'+t.commentId+'">\n              <img class="cop-l" src="'+t.avatar+'" alt />\n              <div class="cop-c">\n                   <div class="cop-name">'+t.nickName+(1===t.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                   <div class="cop-con">\n                        '+(t.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+t.parentNickName+"</span>\uff1a":"")+(t.content||"")+"\n",t.images&&(a+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+t.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),a+='                   </div>\n                   <div class="cop-fun">\n                        <div class="cop-time">'+d.parseDateForComment(t.createDate)+' \xb7 </div>\n                        <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                        <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                   </div>\n              </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(0<t.likeCount?t.likeCount:"")+"</div></div>         </div>\n"}),s+=a+="</div>"),0<t.childCommentCount-t.totalList.length&&(s+='<div class="cop-more" data-page="1" data-switch="off" data-id="'+t.commentId+'"><span class="cop-more-text">\u70b9\u51fb\u5c55\u5f00'+(4<t.childCommentCount-t.totalList.length?5:t.childCommentCount-t.totalList.length)+'\u6761\u56de\u590d</span><img class="cop-more-btn" src="img/icon_arrow_g2.png" alt /></div>'),o("#commentList").html(s)}))},d.dataInit=function(){t.request({url:d.server[d.env]+"/xiangdao-api/api/news/tale_details/"+d.id,method:"GET",success:function(t){var e,n;console.log(t),0!==t.status||(t=t.json)&&(d.q("#playVideo").src=t.video,d.q("#playVideo").poster=t.cover,d.q("#userAvatar").src=t.userAvatar,d.q("#userNickName").innerText=t.userNickName,d.q("#fansCount").innerText=t.fansCount,d.q("#videoCount").innerText=t.videoCount,0<t.isLike&&((e=d.q("#like")).classList.add("liked"),e.innerText="\u5df2\u5173\u6ce8"),d.q("#title").innerText=t.title,d.q("#location").innerText=d.pcaFilter(t.locationProvinceName)+(t.locationCityName?" \xb7 "+d.pcaFilter(t.locationCityName):""),d.q("#lookNumber").innerText=t.lookNumber,d.q("#likeCount").innerText=0<t.likeCount?t.likeCount:"\u70b9\u8d5e",d.q("#publishDate").innerText=d.parseDate(t.publishDate)+"\u53d1\u5e03",e=t.tagName.split(","),""!==t.tagName&&e&&0<e.length?(n="",e.forEach(function(t){n+='<div class="pan-tag">'+t+"</div>"}),d.q("#tagName").innerHTML=n):d.q("#tagName").style.display="none",t.content?d.q("#content").innerText=t.content:d.q(".pan-cols").style.display="none",t.locationTown&&o.ajax({url:d.server[d.env]+"/xiangdao-api/api/news/tale_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({code:t.locationTown,pageSize:20}),success:function(t){var e,n;console.log(t),0===t.status&&(e=t.json.result)&&0<e.length?(n="",e.forEach(function(t){parseInt(d.id)!==t.taleId&&(n+='<a class="lli" data-id="'+t.taleId+'" href="story.html?id='+t.taleId+'">\n                                <div class="lli-l">\n                                    <img class="lli-img" src="'+t.cover+'" alt />\n                                    <div class="lli-time">'+t.videoDuration+'</div>\n                                </div>\n                                <div class="lli-r">\n                                    <div class="lli-tit">'+t.title+'</div>\n                                    <div class="lli-stit">'+(t.userNickName||"")+"<span>"+t.lookNumber+"</span>\u6b21\u89c2\u770b</div>\n                                </div>\n                            </a>")}),""===(d.q("#tales").innerHTML=n)&&(d.q("#relationStory").style.display="none")):d.q("#relationStory").style.display="none"}}))}}),t.request({url:d.server[d.env]+"/xiangdao-api/api/news/tale/"+d.id+"/house_list",method:"GET",success:function(t){var e,n;console.log(t),0===t.status&&(e=t.json)&&0<e.length?(n="",e.forEach(function(t){n+='<a class="swiper-slide" data-id="'+t.houseId+'" href="house_details.html?houseId='+t.houseId+'">\n             <img class="roll-slide-img" src="'+t.infoCover+'" alt />\n             <div class="roll-slide-stit">'+t.profileStr+'</div>\n             <div class="roll-slide-tit">'+t.infoTitle+"</div>\n         </a>"}),d.q("#houseList").innerHTML=n,s.init(),""===n&&(d.q("#relationHouses").style.display="none")):d.q("#relationHouses").style.display="none"}}),o.ajax({url:d.server[d.env]+"/xiangdao-api/api/news/new_comment_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({bizId:d.id,bizType:5}),success:function(t){if(console.log(t),0===t.status){var e=t.json.result;if((d.commentList=e)&&0<e.length){d.q("#commentNum").innerText=t.json.totalCount,e.forEach(function(t){t.totalList=t.list}),d.renderCommentList();var n=document.querySelectorAll(".link");if(n&&0<n.length)for(var i=0;i<n.length;i++)n[i].addEventListener("click",function(){openApp()},!1)}else{e="";e+='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>',d.q("#comment").innerHTML='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u6d88\u606f</div><div class="comment-nodata-stit">\u6682\u65f6\u8fd8\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f</div></div>'}}}})};var e=document.querySelectorAll(".pan-showall");if(e&&0<e.length)for(var n=0;n<e.length;n++)e[n].addEventListener("click",function(){var t=this.previousElementSibling;t&&t.classList.add("showAll"),this.style.display="none"},!1);o(".show-all").on("click",function(){var t=o(this);t.hasClass("cols")?(t.removeClass("cols").find("span").text("\u6536\u8d77"),t.prev(".vp-list").addClass("showAll")):(t.addClass("cols").find("span").text("\u5c55\u5f00"),t.prev(".vp-list").removeClass("showAll"))});var l=document.querySelectorAll(".link");if(l&&0<l.length)for(var c=0;c<l.length;c++)l[c].addEventListener("click",function(){openApp()},!1);d.init=function(){d.initTab(0),d.eventBind(),d.dataInit()},d.init()});