require.config({paths:{common:"common.min",jquery:"jquery-3.2.1",swiper:"swiper.min"}}),define(["common","jquery","swiper"],function(i,o,n){i.init();var h={server:{dev:"//dev.xiangdao.info",pro:"//www.xiangdao.info"},rType:{10:{name:"\u5355\u4eba\u8ba2\u5e8a\u4f4d"},11:{name:"\u5355\u4eba\u8ba2\u6574\u95f4"},12:{name:"\u53cc\u4eba\u8ba2\u6574\u95f4"},13:{name:"\u4e09\u4eba\u8ba2\u6574\u95f4"},14:{name:"\u56db\u4eba\u8ba2\u6574\u95f4"},20:{name:"\u8ba2\u6574\u95f4"},30:{name:"\u8ba2\u6574\u5957"},40:{name:"\u8ba2\u6574\u680b"}},fType:{1:"\u5305\u4e09\u9910",2:"\u53ef\u505a\u996d",3:"\u4e0d\u5305\u5403\u4e0d\u53ef\u505a\u996d"}};function f(i){return document.querySelector(i)}h.env="dev",h.videoIndexArr=[],h.id=i.parseQueryString().id,h.parseTime=function(i){if(i){i=new Date(i);return i.getFullYear().toString().substring(2)+"\u5e74"+(i.getMonth()+1)+"\u6708"+i.getDate()+"\u65e5"}return""},h.parseDateForComment=function(i){i=new Date(i);return(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1)+"-"+(i.getDate()<10?"0"+i.getDate():i.getDate())+" "+(i.getHours()<10?"0"+i.getHours():i.getHours())+":"+(i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes())},h.init=function(){o.ajax({url:h.server[h.env]+"/xiangdao-api/api/news/village_details/"+h.id,method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({roomId:h.id}),success:function(i){var n,t,e,a,s,o,c,l,d,r,m,p,v,g,u;console.log(i),0===i.status&&(n=i.json,t=f("#playVideo"),u=f("#videoFullScreen"),t.src=n.video,t.poster=n.cover,t.oncanplay=function(){t.play()},u.addEventListener("click",function(){t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()},!1),e=f(".hc-tit"),a=f(".hc-inf"),s=f("#content"),f("#validDate"),l=f("#bookingNotice"),o=f("#housePolicy"),c=f(".top-tags-l"),i=f(".pe-list"),u=f("#areaAddress"),f("#priceRemark"),e.innerText=n.villageTitle,a.innerText=n.villageName,n.housePolicy&&o?o.innerHTML=n.housePolicy:f("#housePolicyEl").style.display="none",n.content&&s?s.innerHTML=n.content:f("#contentEl").style.display="none",n.bookingNotice&&l?s.innerHTML=n.bookingNotice:f("#bookingNoticeEl").style.display="none",l.innerHTML=n.bookingNotice,n.villageTagName&&(l=n.villageTagName.split(","),r=d="",l.forEach(function(i,n){n<4?d+='<div class="top-tag">'+i+"</div>":f(".top-tags-r").style.display="block",r+='<div class="top-tag-pop">'+i+"</div>"}),c.innerHTML=d,i.innerHTML=r),u&&(u.innerText=n.locationProvinceName+n.locationCityName+n.locationTownName),h.getHouse(),n.villageIcon&&n.villageIconList&&0<n.villageIconList.length&&(m="",p=n.villageIcon.split(","),n.villageIconList.forEach(function(t){m+='<div class="pt-group">\n                                                    <div class="pt-tit"><img class="pt-yqss" src="'+t.typeUrl+'" alt />'+t.typeName+'</div>\n                                                    <div class="pt-con">',p.forEach(function(i){var n=i.split("-");~~n[0]!=~~t.type||(i=t.list)&&0<i.length&&i.forEach(function(i){~~n[1]==~~i.iconSeq&&(m+='<div class="pt-li">\n                                                                <img class="pt-img" src="'+i.iconUrl+'" alt/>\n                                                                <div class="pt-name">'+i.iconName+"</div>\n                                                            </div>")})}),m+="</div></div>"}),f("#insWrap").innerHTML=m),n.faqList&&0<n.faqList.length?(v="",n.faqList.forEach(function(i){v+='<div class="pan-question">\n                                            <div class="pq-ask">'+i.issue+'</div>\n                                            <div class="pq-ans"><span>'+i.reply+"</span>\n                                            </div>\n                                        </div>"}),f("#faqWrap").innerHTML=v):f("#faqEl").style.display="none",n.aqList&&0<n.aqList.length&&0<n.aqCount&&(g="",n.aqList.forEach(function(i){g+='<div class="ask-li">\n                                        <div class="ask-l">\u95ee</div>\n                                        <div class="ask-c">'+i.title+'</div>\n                                        <div class="ask-r">'+i.replyCount+"\u4e2a\u56de\u7b54</div>\n                                    </div>"}),g+='<div class="ask-btn">\u67e5\u770b\u5168\u90e8</div>',f("#askList").innerHTML=g,f(".ask-nodata").style.display="none"),n.commentCount?(h.commentList=n.commentList,n.commentList.forEach(function(i){i.totalList=i.list}),h.renderCommentList()):(u="",u+='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u8bc4\u8bba</div><div class="comment-nodata-stit">\u8fd8\u6ca1\u6709\u623f\u5ba2\u5bf9\u8be5\u623f\u6e90\u53d1\u51fa\u8bc4\u8bba</div></div>',f("#commentList").innerHTML='<div class="comment-nodata"><img class="comment-nodata-icon" src="img/comment_nodata.png" alt /><div class="comment-nodata-tit">\u6682\u65e0\u8bc4\u8bba</div><div class="comment-nodata-stit">\u8fd8\u6ca1\u6709\u623f\u5ba2\u5bf9\u8be5\u623f\u6e90\u53d1\u51fa\u8bc4\u8bba</div></div>'),h.locationProvinceName=n.locationProvinceName,h.locationCityName=n.locationCityName,h.locationTownName=n.locationTownName,h.getNear())}}),h.bindTag1(),h.onAMapLoaded()},h.getHouse=function(){o.ajax({url:h.server[h.env]+"/xiangdao-api/api/house/house_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({villageId:h.id}),success:function(i){var e;console.log(i),0!==i.status||(i=i.json)&&i.result&&0<i.result.length&&(e="",i.result.forEach(function(i){var n,t="";!i.houseTagName||(n=i.houseTagName.split(","))&&0<n.length&&n.forEach(function(i){t+='<div class="hli-tag">'+i+"</div>"}),e+='<div class="hli">\n                                        <div class="hli-tit">'+i.infoTitle+'</div>\n                                        <div class="hli-row">\n                                            <img class="hli-l" src="'+i.infoCover+'" alt />\n                                            <div class="hli-r">\n                                                <div class="hli-tags">'+t+'</div>\n                                                <div class="hli-inf">30\u665a\u8d77\u79df</div>\n                                                <div class="hli-pri">\u5355\u4ef7<i>\uffe5</i><span>'+30*i.dayReferPrice+'</span></div>\n                                                <div class="hli-dw">\u8d77/'+[null,"\u5e8a\u4f4d","\u72ec\u7acb\u623f\u95f4","\u6574\u5957\u51fa\u79df","\u6574\u680b\u51fa\u79df"][i.ruleRentType]+'/30\u665a</div>\n                                                <div class="hli-btn">\u8be6\u60c5</div>\n                                            </div>\n                                        </div>\n                                    </div>'}),f("#houseWrap").innerHTML=e)}})},h.bindTag1=function(){var i=f(".hc-tags"),n=f(".pe-close");i&&i.addEventListener("click",function(){var i,n,t;f(".pe")&&(f(".pe").style.display="flex"),i=document.documentElement.scrollTop||document.body.scrollTop,n=document.body,(t=n.style).position="fixed",t.top=-i+"px",t.left="0",t.right="0",t.bottom="0",n.dataset.st=i.toString()},!1),n&&n.addEventListener("click",function(){var i;f(".pe")&&(f(".pe").style.display="none"),document.body.style.position="static",window.scroll(0,i||document.body.dataset.st)},!1)},h.getNear=function(i){o.ajax({url:h.server[h.env]+"/xiangdao-api/api/news/search_list",method:"POST",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({searchLocation:i,pageNo:1}),success:function(i){var n;console.log(i),0===i.status&&(i=i.json.result,(h.nearList=i)&&0<i.length&&(n="",i.forEach(function(t){var e,a,i;1===t.type&&(e="",a=[],t.tagName&&((i=t.tagName.split(",")).forEach(function(i,n){a.push(i),n<4&&(e+='<div class="sai-tro sai-tro-all" data-id="'+t.id+'">'+i+"</div>")}),i&&4<i.length&&(e+='<img class="sai-tro-more sai-tro-all" data-id="'+t.id+'" src="img/icon_arrow_rs.png" alt />'),t.tagList=a),n+='<div class="sa-li">\n                                        <div class="sai-t">\n                                            <div class="sai-tl">\n                                                <img class="sai-tl-img" src="'+t.cover+'" alt />\n                                                <div class="sai-tl-pos">'+t.locationProvinceName.replace(/\u7701/,"")+" \xb7 "+t.locationCityName.replace(/[\u5e02\u53bf\u533a]/g,"")+'</div>\n                                            </div>\n                                            <div class="sai-tr">'+e+'</div>\n                                        </div>\n                                        <div class="sai-st">'+t.name+'</div>\n                                        <div class="sai-tit">'+t.title+'</div>\n                                        <div class="sai-inf"><span><i>\uffe5</i>'+(t.monthReferPrice||(t.dayReferPrice?30*t.dayReferPrice:0))+"</span>\u8d77/"+("10"===t.reserveType?"\u4eba/":"")+h.rType[t.reserveType].name.slice(-2)+'/30\u665a</div>\n                                        <div class="sai-row">\n                                            <div class="sai-tags">\n                                            '+(t.foodType?'<div class="sai-tag-l">'+h.fType[t.foodType]+"</div>":"")+'\n                                            <div class="sai-tag-r '+(t.foodType?"":"sai-tag-single")+'">30\u665a\u8d77\u79df</div>\n                                            </div>\n                                            <div class="sai-detail">\u8be6\u60c5</div>\n                                        </div>\n                                    </div>')}),f("#saList").innerHTML=n,(i=document.querySelectorAll(".sai-tro-all"))&&0<i.length&&i.forEach(function(i){i.addEventListener("click",function(i){var t=i.target.dataset.id,i=h.nearList;i&&0<i.length&&i.forEach(function(i){var n;~~t==~~i.id&&(i=i.tagList,n="",i&&0<i.length&&(i.forEach(function(i){n+='<div class="top-tag-pop">'+i+"</div>"}),f(".pe3-list").innerHTML=n,f(".pe3").style.display="flex",f(".pe3-close").addEventListener("click",function(){f(".pe3").style.display="none"},!1)))})},!1)})))}})},h.renderCommentList=function(){var s,i=h.commentList;i&&0<i.length&&(s="",i.forEach(function(i){if(s+='<div class="comment-li" data-id="'+i.commentId+'">\n<div class="comment-li-wrap">                        <img class="comment-l" src="'+i.avatar+'" alt />\n                        <div class="comment-c">\n                            <div class="comment-name">'+i.nickName+'</div>\n                            <div class="comment-con">'+(i.content||"")+"</div>\n",i.images){var n=i.images.split(",");if(n&&0<n.length){for(var t='<div class="comment-imgs">',e=0;e<n.length;e++)t+='<img class="comment-img swiper-lazy" data-index="'+e+'" data-img="'+i.images+'" src="'+n[e]+'" alt />';s+=t+="</div>"}}var a;s+='<div class="comment-fun">\n                <div class="comment-time">'+h.parseDateForComment(i.createTime)+' \xb7 </div>\n                <div class="comment-btn-reply link">\u56de\u590dTA</div>\n                <img class="comment-btn-more link" src="img/icon_more_s.png" alt />\n           </div>',s+='</div>\n           <div class="comment-r link">\n               <img class="comment-like-icon" src="img/icon_like_g.png" alt />\n               <div class="comment-like-num">'+(0<i.likeCount?i.likeCount:"")+"</div>\n           </div>\n       </div>",i.totalList&&0<i.totalList.length&&(a="",a+='<div class="comment-reply">',i.totalList.forEach(function(i){a+='<div class="cop-li" data-id="'+i.commentId+'">\n              <img class="cop-l" src="'+i.avatar+'" alt />\n              <div class="cop-c">\n                   <div class="cop-name">'+i.nickName+(1===i.isAuthor?'<span class="cop-author">\u4f5c\u8005</span>':"")+'</div>\n                   <div class="cop-con">\n                        '+(i.parentNickName?'\u56de\u590d<span class="link" style="color:#3397C6"> @'+i.parentNickName+"</span>\uff1a":"")+(i.content||"")+"\n",i.images&&(a+='<span class="cop-con-show-img swiper-lazy" data-index="0" data-img="'+i.images+'"><img class="cop-con-icon" src="img/icon_img_s.png" alt /><span>\u67e5\u770b\u56fe\u7247</span></span>\n'),a+='                   </div>\n                   <div class="cop-fun">\n                        <div class="cop-time">'+h.parseDateForComment(i.createTime)+' \xb7 </div>\n                        <div class="cop-btn-reply link">\u56de\u590dTA</div>\n                        <img class="cop-btn-more link" src="img/icon_more_s.png" alt />\n                   </div>\n              </div>\n<div class="cop-r link"><img class="cop-like-icon" src="img/icon_like_g.png" alt /><div class="cop-like-num">'+(0<i.likeCount?i.likeCount:"")+"</div></div>         </div>\n"}),s+=a+="</div>"),0<i.childCommentCount-i.totalList.length&&(s+='<div class="cop-more" data-page="1" data-switch="off" data-id="'+i.commentId+'"><span class="cop-more-text">\u70b9\u51fb\u5c55\u5f00'+(4<i.childCommentCount-i.totalList.length?5:i.childCommentCount-i.totalList.length)+'\u6761\u56de\u590d</span><img class="cop-more-btn" src="img/icon_arrow_g2.png" alt /></div>'),o("#commentList").html(s)}))},h.onAMapLoaded=function(){var t=new AMap.Map("mapContainer",{zoom:11});AMap.plugin("AMap.Geocoder",function(){(new AMap.Geocoder).getLocation("\u6d77\u5357\u7701\u4e09\u4e9a\u5e02",function(i,n){var a;"complete"===i&&n.geocodes.length?(a=n.geocodes[0].location,t.setCenter([a.lng,a.lat]),h.lng=a.lng,h.lat=a.lat,n=new AMap.Marker({icon:"/h5/img/pos.png",position:[a.lng,a.lat],anchor:"bottom-center"}),t.add(n),AMap.plugin(["AMap.PlaceSearch"],function(){new AMap.PlaceSearch({pageSize:6,pageIndex:1,datatype:"poi",city:h.locationCity,citylimit:!0,autoFitView:!0}).searchNearBy("\u706b\u8f66\u7ad9",[a.lng,a.lat],1e5,function(i,n){var t,e;n&&n.poiList&&n.poiList.pois&&0<n.poiList.pois.length&&(n=n.poiList.pois,t=[],n.forEach(function(i){t.push(i)}),e=(h.distance=t).sort(function(i,n){return i.distance-n.distance})[0],AMap.plugin("AMap.Driving",function(){var i=new AMap.Driving({policy:AMap.DrivingPolicy.LEAST_TIME}),n=[e.location.lng,e.location.lat],t=[a.lng,a.lat];i.search(n,t,function(i,n){n=n.routes[0].time;f("#distance").innerText="\u8ddd"+e.name+"\u9a7e\u8f66\u8ddd\u79bb"+e.distance/1e3+"\u516c\u91cc\uff0c\u7ea6"+parseInt(n/60)+"\u5206\u949f"})}))})})):console.log("\u83b7\u53d6\u7ecf\u7eac\u5ea6\u5931\u8d25")})})};var t=document.querySelectorAll(".pan-showall");if(t&&0<t.length)for(var e=0;e<t.length;e++)t[e].addEventListener("click",function(){var i=this.previousElementSibling;i&&i.classList.add("showAll"),this.style.display="none"},!1);var a=document.querySelectorAll(".pan-showall2");if(a&&0<a.length)for(var s=0;s<a.length;s++)a[s].addEventListener("click",function(){var i=this.previousElementSibling;"1"!==this.dataset.switch?(this.innerText="\u6536\u8d77 >>",this.dataset.switch="1",i&&i.classList.add("showAll")):(this.innerText="\u8be6\u60c5 >>",this.dataset.switch="0",i&&i.classList.remove("showAll"))},!1);var c=document.querySelectorAll(".link");if(c&&0<c.length)for(var l=0;l<c.length;l++)c[l].addEventListener("click",function(){openApp()},!1);h.init()});