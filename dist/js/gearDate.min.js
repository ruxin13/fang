window.GearDate=function(){function e(){this.scrollTop=0,this.selectedArray=[],this.startValue="",this.endValue="",this.clickTag=0,Element.prototype.ca=function(e){return!!e&&this.classList.add(e)},Element.prototype.cm=function(e){return!!e&&this.classList.remove(e)},Element.prototype.cc=function(e){return!!e&&this.classList.contains(e)}}function O(e){return document.querySelector(e)}function R(e){return document.querySelectorAll(e)}var G="gde-sel-start",W="gde-sel-center",j="gde-sel-end",z="gde-head-disabled",J="\u8bf7\u9009\u62e9\u5165\u4f4f\u65e5\u671f",K="\u8bf7\u9009\u62e9\u65e5\u671f";function P(e,t){var e=e.split("-"),t=t.split("-"),a=new Date(e[0],~~e[1]-1,e[2]),t=new Date(t[0],~~t[1]-1,t[2]),n=[];if(a<t)for(var d=(t.getTime()-a.getTime())/864e5,r=0;r<=d;r++){var i={};0===r?i.isStart=!0:r===d?i.isEnd=!0:i.isCenter=!0,i.date=a.getTime()+864e5*r,n.push(i)}return n}function Q(e,t){return e instanceof Date?U(e.getFullYear(),e.getMonth(),e.getDate(),t):""}function U(e,t,a,n){return(t=1+~~t)<10&&(t="0"+t),a<10&&(a="0"+a),n?""+e+t+a:e+"-"+t+"-"+a}return e.prototype={init:function(e){this.params=e,this.startInput=O(e.startInput),this.endInput=O(e.endInput),this.totalDaysEl=O(e.totalDays),this.trigger=O(e.trigger),this.totalMonth=e.totalMonth||12,this.startValue&&this.endValue&&this.startInput.value&&this.endInput.value&&(this.startValue=this.startInput.value,this.endValue=this.endInput.value,this.selectedArray=P(this.startValue,this.endValue)),this.bindEvent()},bindEvent:function(){var H=this;H.trigger.addEventListener("click",function(){H.lockBg();for(var e=new Date,a=e.getFullYear(),t=e.getMonth(),n=e.getDate(),d=new Date(a,t,n),r="",i="",s="",o=0;o<H.totalMonth;o++){var l=t+o,c=!1;11<l&&(c=!c);for(var u=0;u<Math.ceil(H.totalMonth/12);u++)11<l&&(l-=12);r+='<div class="gde-head-mon '+(0===o?"gde-month-cur":"")+'" data-y="'+(c?a+Math.floor((o+t)/12):a)+'"\n                        data-m="'+l%12+'" data-index="'+o+'">'+["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d","\u5341","\u5341\u4e00","\u5341\u4e8c"][~~(l%12)]+"\u6708</div>"}for(var g=0;g<7;g++)i+='<div class="gde-head-d '+(0===g||6===g?"gde-weekend":"")+'">'+["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"][~~g]+"</div>";for(var h=0;h<H.totalMonth;h++){s+='<div class="gde-month">';for(var v=t+h,f=a,m=new Date(f,v,1).getDay(),p=0;p<Math.ceil(H.totalMonth);p++)11<v&&(v-=12,f++);var y=v+1;s+='<div class="gde-head-ym" id="M'+f+(y=y<10?"0"+y:y)+'">'+f+"\u5e74"+(v+1)+"\u6708</div>",s+='<div class="gde-dates">';var T=[31,28,31,30,31,30,31,31,30,31,30,31];((y=f)%4==0&&y%100!=0||y%400==0)&&(T[1]=29);for(var E=0;E<m;E++)s+='<div class="gde-mdd-emp"></div>';for(var D=0;D<T[v];D++){var M="";if(new Date(f,v,D+1)<d)M="gde-out";else if(H.startValue&&H.endValue&&0<H.selectedArray.length)for(var b=0;b<H.selectedArray.length;b++){var I=new Date(H.selectedArray[b].date);I.getFullYear()===f&&I.getMonth()===v&&I.getDate()===D+1&&(H.selectedArray[b].isStart?M=G:H.selectedArray[b].isCenter?M=W:H.selectedArray[b].isEnd&&(M=j))}s+='<div class="gde-mdd '+M+'" data-y="'+f+'" data-m="'+v+'" data-d="'+(D+1)+'" id="D'+U(f,v,D+1,!0)+'">'+(D+1)+"</div>"}s+="</div></div>"}H.gearArea=document.createElement("div"),H.gearArea.className="gde",H.gearArea.innerHTML='<div class="gde-mask"></div>\n                        <div class="gde-main">\n                            <div class="gde-top">\n                                <div class="gde-reset" id="gdeReset">\u91cd\u7f6e</div>\n                                <div class="gde-tit">\u9884\u8ba2\u65e5\u671f</div>\n                                <img class="gde-close" src="img/icon_close.png" alt />\n                            </div>\n                            <div class="gde-ret">\n                                <div class="gde-ret-l">\n                                    <div class="gde-ret-t">\u5165\u4f4f\u65f6\u95f4</div>\n                                    <div class="gde-ret-b" id="startDateMirror">'+(H.startInput?H.startInput.value||K:"")+'</div>\n                                </div>\n                                <div class="gde-ret-c" id="totalDaysMirror">'+(H.totalDaysEl?H.totalDaysEl.innerText?H.totalDaysEl.innerText.replace(/^\d/,""):"-":"")+'</div>\n                                <div class="gde-ret-r">\n                                    <div class="gde-ret-t">\u79bb\u5f00\u65f6\u95f4</div>\n                                    <div class="gde-ret-b" id="endDateMirror">'+(H.endInput?H.endInput.value||K:"")+'</div>\n                                </div>\n                            </div>\n                            <div class="gde-head-year">\n                                <img class="gde-head-yl '+z+'" id="prevYear" src="img/icon_arrow_down.png" alt />\n                                <div class="gde-head-yn">'+a+'\u5e74</div>\n                                <img class="gde-head-yr" id="nextYear" src="img/icon_arrow_down.png" alt />\n                            </div>\n                            <div class="gde-head-month">'+r+'</div>\n                            <div class="gde-head-day">'+i+'</div>\n                            <div class="gde-body">'+s+'</div>\n                            <div class="gde-btn-confirm gde-disabled" id="gdeNext">'+J+"</div>\n                        </div>",document.body.appendChild(H.gearArea),O(".gde").ca("slideIn");var x=O(".gde-body"),w=O("#gdeNext"),A=O(".gde-head-yn"),V=O("#prevYear"),k=O("#nextYear");H.startValue&&H.endValue&&(e=~~H.startValue.split("-")[0],(n=O("#M"+(n=H.startValue.split("-"))[0]+n[1]))&&x.scrollTo(0,n.offsetTop-x.offsetTop),A&&(A.innerText=e+"\u5e74"),a<e&&V.cm(z),e=O("#M"+(1+(A=~~H.endValue.split("-")[0]))+"01"),A&&e?k.cm(z):k.ca(z),w.cm("gde-disabled"),w.innerText="\u5b8c\u6210",w.addEventListener("click",function(){this.cc("gde-disabled")||(H.startInput&&(H.startInput.value=H.startValue),H.endInput&&(H.endInput.value=H.endValue),H.selectedArray=P(H.startValue,H.endValue),H.close())},!1));var L,S,Y,C,N,_,B=R(".gde-head-mon"),A=R(".gde-head-ym");B&&0<B.length&&(e=function(){var e=this.scrollTop,e=S(N,e);_!==e?L(_=e):(function(){var e=O(".gde-month-cur");{var t;e&&((t=e.dataset.y)<=a?V.ca(z):V.cm(z),O("#M"+(1+~~t)+"01")?k.cm(z):k.ca(z),(e=O(".gde-head-yn"))&&(e.innerText=t+"\u5e74"))}}(),~~C===e&&(Y=!1))},L=function(a){var e=B;e&&0<e.length&&e.forEach(function(e,t){Y||(a===t?(e.ca("gde-month-cur"),O(".gde-head-month").scrollTo({left:e.offsetLeft,behavior:"smooth"})):e.cm("gde-month-cur"))})},Y=!(S=function(e,t){for(var a=0;a<e.length;a++)if(e[a]>t)return a-1}),C=0,B.forEach(function(n){n.addEventListener("click",function(){Y=!0;var e=n.dataset,t=e.y,a=e.m;C=n.dataset.index;e=R(".gde-month-cur");e&&0<e.length&&e.forEach(function(e){e.cm("gde-month-cur")}),n.ca("gde-month-cur");a=1+~~a;x.scrollTo({top:O("#M"+t+(a=a<10?"0"+a:a)).offsetTop-x.offsetTop,behavior:"smooth"})},!1)}),N=[],_=void 0,A.forEach(function(e){N.push(e.offsetTop-x.offsetTop-document.documentElement.clientWidth/750*40*.75)}),N.push(100*document.body.clientHeight),N[0]=100*-document.body.clientHeight,_=0,x.addEventListener("scroll",e,!1)),O("#gdeReset").addEventListener("click",function(){H.clear()},!1),O(".gde-close").addEventListener("click",function(){H.close()},!1);var q=R(".gde-mdd");if(q&&0<q.length)for(var F=0;F<q.length;F++)q[F].cc("gde-out")||q[F].addEventListener("click",function(){var e,t,a,n=this.dataset,d=n.y,r=n.m,i=n.d;0===H.clickTag?(H.clear(),this.ca(G),H.selectedArray.push({date:new Date(~~d,~~r,~~i).getTime(),isStart:!0}),O("#startDateMirror").innerText=U(d,r,i),w.ca("gde-disabled"),w.innerText="\u8bf7\u9009\u62e9\u9000\u623f\u65e5\u671f",H.clickTag=1):1===H.clickTag&&((n=new Date(~~d,~~r,~~i).getTime())<H.selectedArray[0].date?(H.clear(),this.ca(G),H.selectedArray.push({date:new Date(~~d,~~r,~~i).getTime(),isStart:!0}),O("#startDateMirror").innerText=U(d,r,i)):n>H.selectedArray[0].date&&((e=P(Q(new Date(H.selectedArray[0].date)),U(d,r,i)))&&0<e.length&&(e.forEach(function(e){var t=O("#D"+Q(new Date(e.date),!0));e.isStart&&t.ca(G),e.isCenter&&t.ca(W),e.isEnd&&t.ca(j)}),t=Q(new Date(e[0].date)),a=U(d,r,i),O("#endDateMirror").innerText=a,O("#totalDaysMirror").innerText="\u5171"+(e.length-1)+"\u665a",w.addEventListener("click",function(){H.startInput&&(H.startInput.value=t),H.endInput&&(H.endInput.value=a),H.startValue=t,H.endValue=a,H.selectedArray=e,H.totalDaysEl&&(H.totalDaysEl.innerText="\u5171"+(e.length-1)+"\u665a"),H.close()},!1),H.clickTag=0),w.cm("gde-disabled"),w.innerText="\u5b8c\u6210"))},!1);V.addEventListener("click",function(){var e;this.cc(z)||(e=O(".gde-month-cur"),(e=O("#M"+((e?~~e.dataset.y:a)-1)+"01"))?x.scrollTo({top:e.offsetTop-x.offsetTop,behavior:"smooth"}):x.scrollTo({top:0,behavior:"smooth"}))},!1),k.addEventListener("click",function(){var e;this.cc(z)||(e=O(".gde-month-cur"),(e=O("#M"+((e?~~e.dataset.y:a)+1)+"01"))&&x.scrollTo({top:e.offsetTop-x.offsetTop,behavior:"smooth"}))},!1)},!1)},close:function(){var t=this,e=new CustomEvent("input");this.startInput&&this.startInput.dispatchEvent(e);var a=O(".gde");a.cm("slideIn"),a.ca("slideOut"),this.unlockBg(),a.querySelector(".gde-main").addEventListener("webkitAnimationEnd",function(e){"slideOut"===e.animationName&&(a.remove(),t.gearArea=null)})},clear:function(){var e=R("."+G),t=R("."+W),a=R("."+j),n=O("#startDateMirror"),d=O("#endDateMirror"),r=O("#totalDaysMirror"),i=O("#gdeNext");e&&0<e.length&&e.forEach(function(e){e.cm(G)}),t&&0<t.length&&t.forEach(function(e){e.cm(W)}),a&&0<a.length&&a.forEach(function(e){e.cm(j)}),n&&(n.innerText=K),d&&(d.innerText=K),r&&(r.innerText="-"),i&&(i.innerText=J,i.ca("gde-disabled")),this.startInput&&(this.startInput.value=""),this.endInput&&(this.endInput.value=""),this.startValue="",this.endValue="",this.totalDaysEl&&(this.totalDaysEl.innerText="-"),this.selectedArray.length=0},lockBg:function(){var e=document.documentElement.scrollTop||document.body.scrollTop;this.scrollTop=e;var t=document.body,a=t.style;a.position="fixed",a.top=-e+"px",a.left="0",a.right="0",a.bottom="0",t.dataset.st=e.toString()},unlockBg:function(e){document.body.style.position="static",window.scroll(0,e||document.body.dataset.st)}},e}();