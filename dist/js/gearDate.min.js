window.GearDate=function(){function t(){this.scrollTop=0,this.selectedArray=[],this.startValue="",this.endValue="",this.clickTag=0,this.q=function(t){return document.querySelector(t)},this.qa=function(t){return document.querySelectorAll(t)},Element.prototype.ca=function(t){return!!t&&this.classList.add(t)},Element.prototype.cm=function(t){return!!t&&this.classList.remove(t)},Element.prototype.cc=function(t){return!!t&&this.classList.contains(t)}}return t.prototype={init:function(t){this.params=t,this.startClass="gde-sel-start",this.centerClass="gde-sel-center",this.endClass="gde-sel-end",this.hdClass="gde-head-disabled",this.startString="\u8bf7\u9009\u62e9\u5165\u4f4f\u65e5\u671f",this.endString="\u8bf7\u9009\u62e9\u9000\u623f\u65e5\u671f",this.dateString="\u8bf7\u9009\u62e9\u65e5\u671f",this.startInput=this.q(t.startInput),this.endInput=this.q(t.endInput),this.totalDaysEl=this.q(t.totalDays),this.trigger=this.q(t.trigger),this.totalMonth=t.totalMonth||12,this.startValue&&this.endValue&&this.startInput.value&&this.endInput.value&&(this.startValue=this.startInput.value,this.endValue=this.endInput.value,this.selectedArray=this.dayToArray(this.startValue,this.endValue)),this.bindEvent()},bindEvent:function(){var H=this;H.trigger.addEventListener("click",function(){H.lockBg();for(var t=new Date,a=t.getFullYear(),e=t.getMonth(),n=t.getDate(),s=new Date(a,e,n),r="",d="",i="",l=0;l<H.totalMonth;l++){var o=e+l,c=!1;11<o&&(c=!c);for(var h=0;h<Math.ceil(H.totalMonth/12);h++)11<o&&(o-=12);r+='<div class="gde-head-mon '+(0===l?"gde-month-cur":"")+'" data-y="'+(c?a+Math.floor((l+e)/12):a)+'"\n                        data-m="'+o%12+'" data-index="'+l+'">'+H.translateMonth(o%12)+"\u6708</div>"}for(var u=0;u<7;u++)d+='<div class="gde-head-d '+(0===u||6===u?"gde-weekend":"")+'">'+H.translateDay(u)+"</div>";for(var g=0;g<H.totalMonth;g++){i+='<div class="gde-month">';for(var v=e+g,f=a,m=new Date(f,v,1).getDay(),p=0;p<Math.ceil(H.totalMonth);p++)11<v&&(v-=12,f++);var y=v+1;i+='<div class="gde-head-ym" id="M'+f+(y=y<10?"0"+y:y)+'">'+f+"\u5e74"+(v+1)+"\u6708</div>",i+='<div class="gde-dates">';var T=[31,28,31,30,31,30,31,31,30,31,30,31];H.isLeapYear(f)&&(T[1]=29);for(var q=0;q<m;q++)i+='<div class="gde-mdd-emp"></div>';for(var D=0;D<T[v];D++){var E="";if(new Date(f,v,D+1)<s)E="gde-out";else if(H.startValue&&H.endValue&&0<H.selectedArray.length)for(var C=0;C<H.selectedArray.length;C++){var M=new Date(H.selectedArray[C].date);M.getFullYear()===f&&M.getMonth()===v&&M.getDate()===D+1&&(H.selectedArray[C].isStart?E=H.startClass:H.selectedArray[C].isCenter?E=H.centerClass:H.selectedArray[C].isEnd&&(E=H.endClass))}i+='<div class="gde-mdd '+E+'" data-y="'+f+'" data-m="'+v+'" data-d="'+(D+1)+'" id="D'+H.ymdToStr(f,v,D+1,!0)+'">'+(D+1)+"</div>"}i+="</div></div>"}H.gearArea=document.createElement("div"),H.gearArea.className="gde",H.gearArea.innerHTML='<div class="gde-mask"></div>\n                        <div class="gde-main">\n                            <div class="gde-top">\n                                <div class="gde-reset" id="gdeReset">\u91cd\u7f6e</div>\n                                <div class="gde-tit">\u9884\u8ba2\u65e5\u671f</div>\n                                <img class="gde-close" src="img/icon_close.png" alt />\n                            </div>\n                            <div class="gde-ret">\n                                <div class="gde-ret-l">\n                                    <div class="gde-ret-t">\u5165\u4f4f\u65f6\u95f4</div>\n                                    <div class="gde-ret-b" id="startDateMirror">'+(H.startInput?H.startInput.value||H.dateString:"")+'</div>\n                                </div>\n                                <div class="gde-ret-c" id="totalDaysMirror">'+(H.totalDaysEl?H.totalDaysEl.innerText?H.totalDaysEl.innerText.replace(/^\d/,""):"-":"")+'</div>\n                                <div class="gde-ret-r">\n                                    <div class="gde-ret-t">\u79bb\u5f00\u65f6\u95f4</div>\n                                    <div class="gde-ret-b" id="endDateMirror">'+(H.endInput?H.endInput.value||H.dateString:"")+'</div>\n                                </div>\n                            </div>\n                            <div class="gde-head-year">\n                                <img class="gde-head-yl '+H.hdClass+'" id="prevYear" src="img/icon_arrow_down.png" alt />\n                                <div class="gde-head-yn">'+a+'\u5e74</div>\n                                <img class="gde-head-yr" id="nextYear" src="img/icon_arrow_down.png" alt />\n                            </div>\n                            <div class="gde-head-month">'+r+'</div>\n                            <div class="gde-head-day">'+d+'</div>\n                            <div class="gde-body">'+i+'</div>\n                            <div class="gde-btn-confirm gde-disabled" id="gdeNext">'+H.startString+"</div>\n                        </div>",document.body.appendChild(H.gearArea),H.q(".gde").ca("slideIn");var S=H.q(".gde-body"),b=H.q("#gdeNext"),I=H.q(".gde-head-yn"),A=H.q("#prevYear"),x=H.q("#nextYear");H.startValue&&H.endValue&&(t=~~H.startValue.split("-")[0],n=H.startValue.split("-"),(n=H.q("#M"+n[0]+n[1]))&&S.scrollTo(0,n.offsetTop-S.offsetTop),I&&(I.innerText=t+"\u5e74"),a<t&&A.cm(H.hdClass),I=~~H.endValue.split("-")[0],t=H.q("#M"+(1+I)+"01"),I&&t?x.cm(H.hdClass):x.ca(H.hdClass),b.cm("gde-disabled"),b.innerText="\u5b8c\u6210",b.addEventListener("click",function(){this.cc("gde-disabled")||(H.startInput&&(H.startInput.value=H.startValue),H.endInput&&(H.endInput.value=H.endValue),H.selectedArray=H.dayToArray(H.startValue,H.endValue),H.close())},!1));var w,V,k,L,Y,N,_=H.qa(".gde-head-mon"),I=H.qa(".gde-head-ym");_&&0<_.length&&(t=function(){var t=this.scrollTop,t=V(Y,t);N!==t?w(N=t):(function(){var t=H.q(".gde-month-cur");{var e;t&&((e=t.dataset.y)<=a?A.ca(H.hdClass):A.cm(H.hdClass),H.q("#M"+(1+~~e)+"01")?x.cm(H.hdClass):x.ca(H.hdClass),(t=H.q(".gde-head-yn"))&&(t.innerText=e+"\u5e74"))}}(),~~L===t&&(k=!1))},w=function(a){var t=_;t&&0<t.length&&t.forEach(function(t,e){k||(a===e?(t.ca("gde-month-cur"),H.q(".gde-head-month").scrollTo({left:t.offsetLeft,behavior:"smooth"})):t.cm("gde-month-cur"))})},k=!(V=function(t,e){for(var a=0;a<t.length;a++)if(t[a]>e)return a-1}),L=0,_.forEach(function(n){n.addEventListener("click",function(){k=!0;var t=n.dataset,e=t.y,a=t.m;L=n.dataset.index;t=H.qa(".gde-month-cur");t&&0<t.length&&t.forEach(function(t){t.cm("gde-month-cur")}),n.ca("gde-month-cur");a=1+~~a;S.scrollTo({top:H.q("#M"+e+(a=a<10?"0"+a:a)).offsetTop-S.offsetTop,behavior:"smooth"})},!1)}),Y=[],N=void 0,I.forEach(function(t){Y.push(t.offsetTop-S.offsetTop-document.documentElement.clientWidth/750*40*.75)}),Y.push(100*document.body.clientHeight),Y[0]=100*-document.body.clientHeight,N=0,S.addEventListener("scroll",t,!1)),H.q("#gdeReset").addEventListener("click",function(){H.clear()},!1),H.q(".gde-close").addEventListener("click",function(){H.close()},!1);var B=H.qa(".gde-mdd");if(B&&0<B.length)for(var F=0;F<B.length;F++)B[F].cc("gde-out")||B[F].addEventListener("click",function(){var t,e,a,n=this.dataset,s=n.y,r=n.m,d=n.d;0===H.clickTag?(H.clear(),this.ca(H.startClass),H.selectedArray.push({date:new Date(~~s,~~r,~~d).getTime(),isStart:!0}),H.q("#startDateMirror").innerText=H.ymdToStr(s,r,d),b.ca("gde-disabled"),b.innerText=H.endString,H.clickTag=1):1===H.clickTag&&((n=new Date(~~s,~~r,~~d).getTime())<H.selectedArray[0].date?(H.clear(),this.ca(H.startClass),H.selectedArray.push({date:new Date(~~s,~~r,~~d).getTime(),isStart:!0}),H.q("#startDateMirror").innerText=H.ymdToStr(s,r,d)):n>H.selectedArray[0].date&&((t=H.dayToArray(H.dateToStr(new Date(H.selectedArray[0].date)),H.ymdToStr(s,r,d)))&&0<t.length&&(t.forEach(function(t){var e=H.q("#D"+H.dateToStr(new Date(t.date),!0));t.isStart&&e.ca(H.startClass),t.isCenter&&e.ca(H.centerClass),t.isEnd&&e.ca(H.endClass)}),e=H.dateToStr(new Date(t[0].date)),a=H.ymdToStr(s,r,d),H.q("#endDateMirror").innerText=a,H.q("#totalDaysMirror").innerText="\u5171"+(t.length-1)+"\u665a",b.addEventListener("click",function(){H.startInput&&(H.startInput.value=e),H.endInput&&(H.endInput.value=a),H.startValue=e,H.endValue=a,H.selectedArray=t,H.totalDaysEl&&(H.totalDaysEl.innerText="\u5171"+(t.length-1)+"\u665a"),H.close()},!1),H.clickTag=0),b.cm("gde-disabled"),b.innerText="\u5b8c\u6210"))},!1);A.addEventListener("click",function(){var t;this.cc(H.hdClass)||(t=H.q(".gde-month-cur"),(t=H.q("#M"+((t?~~t.dataset.y:a)-1)+"01"))?S.scrollTo({top:t.offsetTop-S.offsetTop,behavior:"smooth"}):S.scrollTo({top:0,behavior:"smooth"}))},!1),x.addEventListener("click",function(){var t;this.cc(H.hdClass)||(t=H.q(".gde-month-cur"),(t=H.q("#M"+((t?~~t.dataset.y:a)+1)+"01"))&&S.scrollTo({top:t.offsetTop-S.offsetTop,behavior:"smooth"}))},!1)},!1)},close:function(){var e=this,t=new CustomEvent("input");this.startInput&&this.startInput.dispatchEvent(t);var a=this.q(".gde");a.cm("slideIn"),a.ca("slideOut"),this.unlockBg(),a.querySelector(".gde-main").addEventListener("webkitAnimationEnd",function(t){"slideOut"===t.animationName&&(a.remove(),e.gearArea=null)})},clear:function(){var e=this,t=this.qa("."+e.startClass),a=this.qa("."+e.centerClass),n=this.qa("."+e.endClass),s=this.q("#startDateMirror"),r=this.q("#endDateMirror"),d=this.q("#totalDaysMirror"),i=this.q("#gdeNext");t&&0<t.length&&t.forEach(function(t){t.cm(e.startClass)}),a&&0<a.length&&a.forEach(function(t){t.cm(e.centerClass)}),n&&0<n.length&&n.forEach(function(t){t.cm(e.endClass)}),s&&(s.innerText=this.dateString),r&&(r.innerText=this.dateString),d&&(d.innerText="-"),i&&(i.innerText=this.startString,i.ca("gde-disabled")),this.startInput&&(this.startInput.value=""),this.endInput&&(this.endInput.value=""),this.startValue="",this.endValue="",this.totalDaysEl&&(this.totalDaysEl.innerText="-"),this.selectedArray.length=0},lockBg:function(){var t=document.documentElement.scrollTop||document.body.scrollTop;this.scrollTop=t;var e=document.body,a=e.style;a.position="fixed",a.top=-t+"px",a.left="0",a.right="0",a.bottom="0",e.dataset.st=t.toString()},unlockBg:function(t){document.body.style.position="static",window.scroll(0,t||document.body.dataset.st)},translateMonth:function(t){return["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d","\u5341","\u5341\u4e00","\u5341\u4e8c"][t=~~t]},translateDay:function(t){return["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"][t=~~t]},isLeapYear:function(t){return t%4==0&&t%100!=0||t%400==0},dayToArray:function(t,e){var t=t.split("-"),e=e.split("-"),a=new Date(t[0],~~t[1]-1,t[2]),e=new Date(e[0],~~e[1]-1,e[2]),n=[];if(a<e)for(var s=(e.getTime()-a.getTime())/864e5,r=0;r<=s;r++){var d={};0===r?d.isStart=!0:r===s?d.isEnd=!0:d.isCenter=!0,d.date=a.getTime()+864e5*r,n.push(d)}return n},dateToStr:function(t,e){return t instanceof Date?this.ymdToStr(t.getFullYear(),t.getMonth(),t.getDate(),e):""},ymdToStr:function(t,e,a,n){return(e=1+~~e)<10&&(e="0"+e),a<10&&(a="0"+a),n?""+t+e+a:t+"-"+e+"-"+a}},t}();